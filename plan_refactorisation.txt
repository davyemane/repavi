# ğŸ“‹ Plan de Refactoring RepAvi Lodges
## ConformitÃ© stricte au Cahier des Charges

---

## ğŸ¯ **OBJECTIF**
Refactorer le projet existant pour respecter **exactement** le cahier des charges, en supprimant tout ce qui n'est pas requis et en implÃ©mentant uniquement les fonctionnalitÃ©s demandÃ©es.

---

## ğŸ—ï¸ **NOUVELLE STRUCTURE D'APPLICATIONS**

### Apps Ã  Garder/Modifier
```python
# apps/users/          âœ… GARDER - Adapter aux profils requis
# apps/appartements/   ğŸ”„ RENOMMER home â†’ Gestion appartements  
# apps/clients/        â• CRÃ‰ER - Gestion clients simple
# apps/reservations/   ğŸ”„ MODIFIER - Simplifier selon cahier
# apps/paiements/      â• CRÃ‰ER - Paiements par tranches
# apps/inventaire/     ğŸ”„ RENOMMER meubles â†’ Inventaire Ã©quipements
# apps/comptabilite/   â• CRÃ‰ER - ComptabilitÃ© simple
# apps/menage/         â• CRÃ‰ER - Planning mÃ©nage
# apps/facturation/    â• CRÃ‰ER - Factures PDF
```

### Apps Ã  Supprimer
```python
# apps/avis/           âŒ SUPPRIMER - Non requis par cahier
# Page d'accueil      âŒ SUPPRIMER - Pas dans les specs
# FonctionnalitÃ©s complexes âŒ SUPPRIMER
```

---

## ğŸ‘¥ **PROFILS UTILISATEURS (Exact cahier)**

### 1. Super Administrateur
- **Qui** : Direction RepAvi Lodges
- **Droits** : AccÃ¨s complet + gestion des gestionnaires
- **Interface** : Tableau de bord complet

### 2. Gestionnaire  
- **Qui** : Personnel opÃ©rationnel
- **Droits** : Gestion quotidienne (clients, rÃ©servations, paiements, inventaire)
- **Interface** : Tableau de bord fonctionnel

### 3. Client
- **Qui** : Locataires
- **Droits** : **AUCUN ACCÃˆS** au systÃ¨me (important !)

---

## ğŸ  **MODÃˆLES DJANGO REQUIS**

### 1. Appartement
```python
class Appartement(models.Model):
    numero = models.CharField(max_length=10, unique=True)
    type_logement = models.CharField(choices=[
        ('studio', 'Studio'),
        ('t1', 'T1'), 
        ('t2', 'T2')
    ])
    maison = models.CharField(max_length=100)  # Nom de la maison
    prix_par_nuit = models.DecimalField(max_digits=10, decimal_places=2)
    statut = models.CharField(choices=[
        ('disponible', 'Disponible'),
        ('occupe', 'OccupÃ©'),
        ('maintenance', 'Maintenance')
    ])
    equipements = models.JSONField(default=list)  # Liste simple
    photos = models.ManyToManyField('PhotoAppartement')
```

### 2. Client  
```python
class Client(models.Model):
    nom = models.CharField(max_length=100)
    prenom = models.CharField(max_length=100)
    telephone = models.CharField(max_length=20)
    email = models.EmailField()
    piece_identite = models.ImageField(upload_to='clients/documents/')
    adresse_residence = models.TextField()
    contact_urgence_nom = models.CharField(max_length=100)
    contact_urgence_tel = models.CharField(max_length=20)
    date_creation = models.DateTimeField(auto_now_add=True)
```

### 3. RÃ©servation
```python
class Reservation(models.Model):
    client = models.ForeignKey(Client, on_delete=models.CASCADE)
    appartement = models.ForeignKey(Appartement, on_delete=models.CASCADE)
    date_arrivee = models.DateField()
    date_depart = models.DateField()
    nombre_nuits = models.IntegerField()
    prix_total = models.DecimalField(max_digits=10, decimal_places=2)
    statut = models.CharField(choices=[
        ('confirmee', 'ConfirmÃ©e'),
        ('en_cours', 'En cours'),
        ('terminee', 'TerminÃ©e'),
        ('annulee', 'AnnulÃ©e')
    ])
```

### 4. Paiement (SIMPLIFIÃ‰)
```python
class EcheancierPaiement(models.Model):
    reservation = models.ForeignKey(Reservation, on_delete=models.CASCADE)
    montant_prevu = models.DecimalField(max_digits=10, decimal_places=2)
    date_echeance = models.DateField()
    montant_paye = models.DecimalField(default=0)
    mode_paiement = models.CharField(choices=[
        ('especes', 'EspÃ¨ces'),
        ('virement', 'Virement bancaire'), 
        ('mobile_money', 'Mobile Money'),
        ('cheque', 'ChÃ¨que')
    ])
    statut = models.CharField(choices=[
        ('en_attente', 'En attente'),
        ('paye', 'PayÃ©')
    ])
```

### 5. Inventaire
```python
class EquipementAppartement(models.Model):
    appartement = models.ForeignKey(Appartement, on_delete=models.CASCADE)
    nom = models.CharField(max_length=100)
    etat = models.CharField(choices=[
        ('bon', 'Bon'),
        ('usage', 'Usage'), 
        ('defectueux', 'DÃ©fectueux'),
        ('hors_service', 'Hors service')
    ])
    prix_achat = models.DecimalField(max_digits=10, decimal_places=2)
    date_achat = models.DateField()
    photo = models.ImageField(upload_to='inventaire/')
    commentaire = models.TextField(blank=True)
```

---

## ğŸ¨ **DESIGN SYSTEM (InspirÃ© des composants React)**

### Couleurs Principales
```css
/* Gradient principal */
--gradient-primary: from-blue-600 to-purple-600;
--gradient-success: from-green-500 to-emerald-500;
--gradient-warning: from-yellow-500 to-orange-500;
--gradient-danger: from-red-500 to-pink-500;

/* Couleurs solides */
--blue-600: #2563eb;
--purple-600: #9333ea;
--green-600: #16a34a;
--red-600: #dc2626;
--gray-50: #f9fafb;
--gray-100: #f3f4f6;
```

### Composants UI RÃ©utilisables
- **Cards** : `bg-white rounded-2xl p-6 border border-gray-100 hover:shadow-lg`
- **Buttons Primary** : `bg-blue-600 text-white py-3 px-6 rounded-xl hover:bg-blue-700`
- **Inputs** : `border border-gray-300 rounded-xl focus:border-blue-600 focus:ring-2 focus:ring-blue-100`
- **Gradients** : `bg-gradient-to-r from-blue-600 to-purple-600`

---

## ğŸ“‹ **MODULES Ã€ IMPLÃ‰MENTER**

### 1. ğŸ  Gestion Appartements (`apps/appartements/`)
- **ModÃ¨les** : Appartement, PhotoAppartement
- **Vues** : Liste, CrÃ©ation, Modification, Changement statut
- **Templates** : Liste avec filtres, Formulaire simple
- **FonctionnalitÃ©s** :
  - âœ… NumÃ©ro, type (Studio/T1/T2), maison
  - âœ… Prix par nuit unique et simple
  - âœ… Statut : Disponible/OccupÃ©/Maintenance
  - âœ… Photos par piÃ¨ce
  - âœ… Liste d'Ã©quipements simple

### 2. ğŸ‘¥ Gestion Clients (`apps/clients/`)
- **ModÃ¨les** : Client
- **Vues** : CRUD complet + recherche
- **Templates** : Liste, Fiche client, Formulaire
- **FonctionnalitÃ©s** :
  - âœ… IdentitÃ© : nom, prÃ©nom, tÃ©lÃ©phone, email
  - âœ… Document : piÃ¨ce d'identitÃ© (photo)
  - âœ… Adresse rÃ©sidence habituelle
  - âœ… Contact d'urgence

### 3. ğŸ“… RÃ©servations (`apps/reservations/`)
- **ModÃ¨les** : Reservation
- **Vues** : Calendrier, CrÃ©ation, Planning
- **Templates** : Calendrier mensuel, Formulaire rÃ©servation
- **FonctionnalitÃ©s** :
  - âœ… Vue mensuelle avec couleurs par statut
  - âœ… CrÃ©ation par Ã©tapes (Client â†’ Appartement â†’ Dates â†’ Tarif â†’ Paiement)
  - âœ… Calcul automatique (nuits Ã— prix)
  - âœ… Alerte conflits de dates

### 4. ğŸ’° Paiements (`apps/paiements/`)
- **ModÃ¨les** : EcheancierPaiement
- **Vues** : Gestion Ã©chÃ©ancier, Enregistrement paiements
- **Templates** : Tableau paiements, Formulaire saisie
- **FonctionnalitÃ©s** :
  - âœ… Plan de paiement simple (Acompte + Solde)
  - âœ… Modes : EspÃ¨ces, Virement, Mobile Money, ChÃ¨que
  - âœ… Suivi tableau avec statut PayÃ©/En attente

### 5. ğŸ› ï¸ Inventaire (`apps/inventaire/`)
- **ModÃ¨les** : EquipementAppartement
- **Vues** : Par appartement, Changement Ã©tat
- **Templates** : Liste Ã©quipements, Formulaire ajout
- **FonctionnalitÃ©s** :
  - âœ… Ã‰tats : Bon, Usage, DÃ©fectueux, Hors service
  - âœ… Infos : Prix d'achat, photo, commentaire
  - âœ… Changement d'Ã©tat en 1 clic
  - âœ… Total valeur par appartement

### 6. ğŸ“Š ComptabilitÃ© (`apps/comptabilite/`)
- **ModÃ¨les** : ComptabiliteAppartement
- **Vues** : Vue mensuelle par appartement
- **Templates** : Tableau revenus/charges
- **FonctionnalitÃ©s** :
  - âœ… Addition revenus par appartement
  - âœ… Soustraction charges manuelles
  - âœ… Pourcentage occupation simple
  - âŒ PAS de calculs complexes/fiscaux

### 7. ğŸ§¹ Planning MÃ©nage (`apps/menage/`)
- **ModÃ¨les** : TacheMenage
- **Vues** : Liste tÃ¢ches, Check-list
- **Templates** : Planning simple, Formulaire check-list
- **FonctionnalitÃ©s** :
  - âœ… Liste appartements Ã  nettoyer aprÃ¨s dÃ©part
  - âœ… Statut : Ã€ faire/En cours/TerminÃ©
  - âœ… Notes personnel mÃ©nage
  - âœ… Photos avant/aprÃ¨s (optionnel)

### 8. ğŸ“„ Facturation (`apps/facturation/`)
- **ModÃ¨les** : Facture
- **Vues** : GÃ©nÃ©ration PDF automatique
- **Templates** : Template PDF
- **FonctionnalitÃ©s** :
  - âœ… PDF avec logo RepAvi Lodges
  - âœ… Infos client et sÃ©jour
  - âœ… DÃ©tail coÃ»ts (nuits + frais)
  - âœ… Plan de paiement si Ã©chÃ©ancÃ©

---

## ğŸ¨ **INTERFACE UTILISATEUR**

### Dashboard Principal (InspirÃ© du design React)
```html
<!-- Structure type -->
<div class="min-h-screen bg-gray-50">
  <!-- Header avec navigation -->
  <header class="bg-white border-b border-gray-200 sticky top-0 z-50">
    <!-- Logo RepAvi Lodges + Navigation -->
  </header>
  
  <!-- Hero Section avec KPIs -->
  <div class="bg-gradient-to-r from-blue-600 to-purple-600 rounded-3xl p-8 text-white">
    <!-- Statistiques principales -->
  </div>
  
  <!-- Modules Grid -->
  <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
    <!-- Cards pour chaque module -->
  </div>
</div>
```

### Cards Modules (Style moderne)
- **Appartements** : IcÃ´ne ğŸ , couleur bleue
- **Clients** : IcÃ´ne ğŸ‘¥, couleur verte  
- **RÃ©servations** : IcÃ´ne ğŸ“…, couleur purple
- **Paiements** : IcÃ´ne ğŸ’°, couleur orange
- **Inventaire** : IcÃ´ne ğŸ› ï¸, couleur indigo
- **ComptabilitÃ©** : IcÃ´ne ğŸ“Š, couleur cyan
- **MÃ©nage** : IcÃ´ne ğŸ§¹, couleur emerald
- **Facturation** : IcÃ´ne ğŸ“„, couleur slate

---

## ğŸ—‚ï¸ **NOUVELLE STRUCTURE FICHIERS**

```
repavi/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ users/                    # âœ… Adapter profils
â”‚   â”œâ”€â”€ appartements/             # ğŸ”„ Ex-home  
â”‚   â”œâ”€â”€ clients/                  # â• Nouveau
â”‚   â”œâ”€â”€ reservations/             # ğŸ”„ Simplifier
â”‚   â”œâ”€â”€ paiements/                # â• Nouveau
â”‚   â”œâ”€â”€ inventaire/               # ğŸ”„ Ex-meubles
â”‚   â”œâ”€â”€ comptabilite/             # â• Nouveau
â”‚   â”œâ”€â”€ menage/                   # â• Nouveau
â”‚   â””â”€â”€ facturation/              # â• Nouveau
â”œâ”€â”€ templates/
â”‚   â”œâ”€â”€ base.html                 # Template de base moderne
â”‚   â”œâ”€â”€ dashboard/                # Dashboard principal
â”‚   â”œâ”€â”€ appartements/             # Templates appartements
â”‚   â”œâ”€â”€ clients/                  # Templates clients
â”‚   â”œâ”€â”€ reservations/             # Templates rÃ©servations
â”‚   â”œâ”€â”€ paiements/                # Templates paiements
â”‚   â”œâ”€â”€ inventaire/               # Templates inventaire
â”‚   â”œâ”€â”€ comptabilite/             # Templates comptabilitÃ©
â”‚   â”œâ”€â”€ menage/                   # Templates mÃ©nage
â”‚   â””â”€â”€ facturation/              # Templates facturation
â”œâ”€â”€ static/
â”‚   â”œâ”€â”€ css/                      # Tailwind compilÃ©
â”‚   â”œâ”€â”€ js/                       # JavaScript simple
â”‚   â””â”€â”€ images/                   # Logo, icÃ´nes
â”œâ”€â”€ media/
â”‚   â”œâ”€â”€ appartements/photos/      # Photos appartements
â”‚   â”œâ”€â”€ clients/documents/        # PiÃ¨ces identitÃ©
â”‚   â”œâ”€â”€ inventaire/               # Photos Ã©quipements
â”‚   â””â”€â”€ menage/                   # Photos avant/aprÃ¨s
â””â”€â”€ config/
    â”œâ”€â”€ settings/                 # Settings simplifiÃ©s
    â”œâ”€â”€ urls.py                   # URLs principales
    â””â”€â”€ wsgi.py
```

---

## âš™ï¸ **Ã‰TAPES DE REFACTORING**

### ğŸ—‘ï¸ **Ã‰TAPE 1 : NETTOYAGE (Jour 1)**

#### Supprimer les Ã©lÃ©ments non requis
```bash
# Apps Ã  supprimer
rm -rf apps/avis/

# Templates page d'accueil
rm -rf templates/home/index.html
rm -rf templates/components/hero.html

# FonctionnalitÃ©s complexes non mentionnÃ©es
# (Ã  identifier dans le code existant)
```

#### Simplifier settings.py
```python
# Garder seulement les apps requises
INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth', 
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    
    # Third party
    'tailwind',
    'theme',
    
    # RepAvi apps - SEULEMENT celles du cahier
    'apps.users',
    'apps.appartements',
    'apps.clients', 
    'apps.reservations',
    'apps.paiements',
    'apps.inventaire',
    'apps.comptabilite',
    'apps.menage',
    'apps.facturation',
]
```

### ğŸ”„ **Ã‰TAPE 2 : RESTRUCTURATION (Jours 2-3)**

#### Renommer et adapter les apps existantes
```bash
# Renommer
mv home/ apps/appartements/
mv meubles/ apps/inventaire/

# CrÃ©er nouvelles apps
python manage.py startapp clients apps/clients
python manage.py startapp paiements apps/paiements  
python manage.py startapp comptabilite apps/comptabilite
python manage.py startapp menage apps/menage
python manage.py startapp facturation apps/facturation
```

#### Adapter le modÃ¨le User
```python
# apps/users/models.py
class User(AbstractUser):
    PROFIL_CHOICES = [
        ('super_admin', 'Super Administrateur'),
        ('gestionnaire', 'Gestionnaire'),
    ]
    profil = models.CharField(max_length=20, choices=PROFIL_CHOICES)
    telephone = models.CharField(max_length=20, blank=True)
    date_creation = models.DateTimeField(auto_now_add=True)
    
    # PAS de profil client - ils n'accÃ¨dent pas au systÃ¨me
```

### ğŸ¨ **Ã‰TAPE 3 : TEMPLATES MODERNES (Jours 4-5)**

#### Base Template (InspirÃ© du design React)
```html
<!-- templates/base.html -->
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}RepAvi Lodges - Gestion{% endblock %}</title>
    {% load static %}
    {% load tailwind_tags %}
    {% tailwind_css %}
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body class="bg-gray-50">
    <!-- Header moderne avec navigation -->
    <header class="bg-white border-b border-gray-200 sticky top-0 z-50">
        <!-- Navigation style moderne comme dans le React -->
    </header>
    
    <!-- Main content -->
    <main class="container mx-auto px-4 py-8">
        {% block content %}{% endblock %}
    </main>
</body>
</html>
```

#### Dashboard Principal
```html
<!-- templates/dashboard/index.html -->
{% extends 'base.html' %}
{% block content %}
<!-- Hero section avec statistiques -->
<div class="bg-gradient-to-r from-blue-600 to-purple-600 rounded-3xl p-8 text-white mb-8">
    <!-- KPIs : Nb appartements, Occupation actuelle, Revenus mois -->
</div>

<!-- Modules Grid -->
<div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
    <!-- Card pour chaque module avec icÃ´nes Material -->
</div>
{% endblock %}
```

### ğŸ“± **RESPONSIVE ET MODERNE**
- Design mobile-first
- Cards avec hover effects
- Gradient backgrounds
- IcÃ´nes Material Design
- Navigation sticky
- Micro-animations CSS

---

## ğŸ”’ **SYSTÃˆME D'AUTHENTIFICATION SIMPLIFIÃ‰**

### URLs d'authentification
```python
# apps/users/urls.py
urlpatterns = [
    path('login/', LoginView.as_view(), name='login'),
    path('logout/', LogoutView.as_view(), name='logout'),
    path('dashboard/', DashboardView.as_view(), name='dashboard'),
    # PAS d'inscription publique - comptes crÃ©Ã©s par admin
]
```

### DÃ©corateurs de sÃ©curitÃ©
```python
from functools import wraps
from django.contrib.auth.decorators import login_required

def super_admin_required(view_func):
    @wraps(view_func)
    @login_required
    def wrapper(request, *args, **kwargs):
        if request.user.profil != 'super_admin':
            return redirect('dashboard')
        return view_func(request, *args, **kwargs)
    return wrapper

def gestionnaire_required(view_func):
    @wraps(view_func)
    @login_required  
    def wrapper(request, *args, **kwargs):
        if request.user.profil not in ['super_admin', 'gestionnaire']:
            return redirect('dashboard')
        return view_func(request, *args, **kwargs)
    return wrapper
```

---

## ğŸ“Š **FONCTIONNALITÃ‰S EXACTES DU CAHIER**

### âœ… **CE QUI DOIT ÃŠTRE INCLUS**
1. **Appartements** : NumÃ©ro, type, prix/nuit, statut, photos, Ã©quipements
2. **Clients** : Fiche simple avec identitÃ©, documents, contacts
3. **RÃ©servations** : Calendrier simple, crÃ©ation 5 Ã©tapes, calcul auto
4. **Paiements** : Ã‰chÃ©ancier simple (Acompte + Solde), modes de paiement
5. **Inventaire** : Liste par appartement, Ã©tats, prix, photos
6. **ComptabilitÃ©** : Addition revenus - charges, % occupation
7. **MÃ©nage** : Planning aprÃ¨s dÃ©parts, check-list simple
8. **Facturation** : PDF automatique avec infos complÃ¨tes

### âŒ **CE QUI DOIT ÃŠTRE EXCLU**
1. RÃ©servations en ligne par clients
2. IntÃ©grations Booking.com/Airbnb
3. Paiements en ligne automatiques
4. Analytics avancÃ©es
5. Application mobile
6. SystÃ¨me de sÃ©curitÃ© complexe
7. Page d'accueil publique

---

## ğŸš€ **PLANNING DE REFACTORING (1 SEMAINE)**

### **Jour 1** : Nettoyage et structure
- Supprimer apps/fonctionnalitÃ©s non requises
- CrÃ©er nouvelle structure d'apps
- Adapter settings.py

### **Jour 2** : ModÃ¨les et base de donnÃ©es
- CrÃ©er tous les modÃ¨les selon cahier
- Migrations
- DonnÃ©es de test simples

### **Jour 3** : Templates de base
- Base template moderne
- Dashboard principal
- Navigation

### **Jour 4** : Vues principales
- Appartements CRUD
- Clients CRUD  
- RÃ©servations basiques

### **Jour 5** : FonctionnalitÃ©s avancÃ©es
- Paiements par tranches
- Inventaire
- ComptabilitÃ© simple

### **Weekend** : Tests et finitions
- Tests fonctionnels
- Optimisations
- Documentation

---

## ğŸ“ **CRITÃˆRES DE VALIDATION**

### â±ï¸ **Performance (Cahier des charges)**
- âœ… CrÃ©er appartement : < 2 minutes
- âœ… Changer statut : 1 clic
- âœ… CrÃ©er rÃ©servation : < 5 minutes
- âœ… Ã‰chÃ©ancier : < 1 minute
- âœ… Pages : < 3 secondes

### ğŸ¯ **SimplicitÃ© d'usage**
- âœ… Formation : 2h maximum
- âœ… Actions courantes : Max 3 clics
- âœ… Messages d'erreur clairs

---

## ğŸ‰ **RÃ‰SULTAT ATTENDU**

Un systÃ¨me **ultra-simple** et **fonctionnel** qui respecte **exactement** le cahier des charges :
- Interface moderne inspirÃ©e du design React fourni
- FonctionnalitÃ©s limitÃ©es aux specs exactes
- Performance et simplicitÃ© d'usage garanties
- Formation de l'Ã©quipe en 2h maximum

**ÃŠtes-vous prÃªt Ã  commencer la refactoring ? Par quelle Ã©tape souhaitez-vous commencer ?**