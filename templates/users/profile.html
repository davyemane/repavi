<!-- users/profile.html - Section complète des scripts JavaScript -->

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Gestion des onglets
    const tabLinks = document.querySelectorAll('.tab-link');
    const tabContents = document.querySelectorAll('.tab-content');
    
    tabLinks.forEach(function(link) {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const target = this.getAttribute('href');
            
            // Réinitialiser tous les onglets
            tabLinks.forEach(function(tab) {
                tab.classList.remove('text-indigo-600', 'border-b-2', 'border-indigo-600');
                tab.classList.add('text-gray-500');
            });
            
            tabContents.forEach(function(content) {
                content.classList.add('hidden');
            });
            
            // Activer l'onglet cliqué
            this.classList.remove('text-gray-500');
            this.classList.add('text-indigo-600', 'border-b-2', 'border-indigo-600');
            document.querySelector(target).classList.remove('hidden');
        });
    });
    
    // Gestion des notifications toggle
    const notificationToggles = document.querySelectorAll('.notification-toggle');
    notificationToggles.forEach(function(toggle) {
        toggle.addEventListener('change', function() {
            const type = this.getAttribute('data-type');
            const enabled = this.checked;
            
            // Envoi AJAX
            fetch('{% url "users:toggle_notification_ajax" %}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                body: new URLSearchParams({
                    'type': type,
                    'enabled': enabled.toString()
                })
            })
            .then(response => response.json())
            .then(data => {
                if (!data.success) {
                    console.error('Erreur lors de la mise à jour des préférences');
                    // Rétablir l'état précédent
                    this.checked = !enabled;
                }
            })
            .catch(error => {
                console.error('Erreur:', error);
                // Rétablir l'état précédent
                this.checked = !enabled;
            });
        });
    });
    
    // Modal de suppression
    const deleteAccountBtn = document.getElementById('deleteAccountBtn');
    const deleteModal = document.getElementById('deleteModal');
    const cancelDelete = document.getElementById('cancelDelete');
    
    if (deleteAccountBtn) {
        deleteAccountBtn.addEventListener('click', function() {
            deleteModal.classList.remove('hidden');
        });
    }
    
    if (cancelDelete) {
        cancelDelete.addEventListener('click', function() {
            deleteModal.classList.add('hidden');
        });
    }
    
    // Fermer le modal en cliquant à l'extérieur
    if (deleteModal) {
        deleteModal.addEventListener('click', function(e) {
            if (e.target === this) {
                this.classList.add('hidden');
            }
        });
    }
});
</script>
{% endblock %}