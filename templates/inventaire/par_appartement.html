<!-- ========================================== -->
<!-- templates/inventaire/par_appartement.html -->
<!-- ========================================== -->
{% extends 'base.html' %}
{% load static %}

{% block title %}Inventaire {{ appartement.numero }} - RepAvi Lodges{% endblock %}

{% block page_title %}Inventaire {{ appartement.numero }}{% endblock %}
{% block page_subtitle %}{{ appartement.get_type_logement_display }} • Valeur totale : {{ valeur_totale|floatformat:0 }} FCFA{% endblock %}

{% block header_actions %}
<div class="flex space-x-3">
    <a href="{% url 'inventaire:ajouter_equipement' appartement.pk %}" 
       class="inline-flex items-center px-4 py-2 bg-[#02066F] text-white rounded-lg text-sm font-medium hover:bg-[#030a8a] transition-colors font-lato">
        <span class="material-icons text-sm mr-2">add</span>
        Ajouter Équipement
    </a>
    
    <a href="{% url 'inventaire:valeur_totale' appartement.pk %}" 
       class="inline-flex items-center px-4 py-2 border border-orange-600 text-orange-600 rounded-lg text-sm font-medium hover:bg-orange-50 transition-colors font-lato">
        <span class="material-icons text-sm mr-2">calculate</span>
        Voir Valeurs
    </a>
    
    <a href="{% url 'inventaire:general' %}" 
       class="inline-flex items-center px-4 py-2 border border-gray-300 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-50 transition-colors font-lato">
        <span class="material-icons text-sm mr-2">arrow_back</span>
        Retour
    </a>
</div>
{% endblock %}

{% block content %}
<!-- Informations appartement -->
<div class="bg-white rounded-lg border border-gray-200 p-6 mb-8">
    <div class="flex items-center justify-between">
        <div class="flex items-center space-x-4">
            <div class="w-16 h-16 bg-[#02066F] rounded-xl flex items-center justify-center">
                <span class="material-icons text-white text-2xl">apartment</span>
            </div>
            <div>
                <h2 class="text-2xl font-bold text-gray-900 font-lato">{{ appartement.numero }}</h2>
                <p class="text-gray-600 font-lato">{{ appartement.get_type_logement_display }}</p>
                {% if appartement.maison %}
                <p class="text-sm text-gray-500 font-lato">{{ appartement.maison }}</p>
                {% endif %}
            </div>
        </div>
        
        <div class="text-right">
            <div class="text-3xl font-bold text-[#02066F] font-lato">{{ equipements.count }}</div>
            <div class="text-gray-600 font-lato">équipements</div>
        </div>
    </div>
</div>

<!-- Statistiques par état selon cahier -->
<div class="grid grid-cols-2 md:grid-cols-4 gap-6 mb-8">
    {% for etat_code, etat_data in stats_etats.items %}
    <div class="bg-white rounded-lg border border-gray-200 p-6">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-sm text-gray-600 font-lato">{{ etat_data.nom }}</p>
                <p class="text-2xl font-bold {% if etat_code == 'bon' %}text-green-600{% elif etat_code == 'usage' %}text-blue-600{% elif etat_code == 'defectueux' %}text-orange-600{% else %}text-red-600{% endif %} font-lato">{{ etat_data.count }}</p>
            </div>
            <div class="w-12 h-12 {% if etat_code == 'bon' %}bg-green-100{% elif etat_code == 'usage' %}bg-blue-100{% elif etat_code == 'defectueux' %}bg-orange-100{% else %}bg-red-100{% endif %} rounded-lg flex items-center justify-center">
                <span class="w-3 h-3 rounded-full {% if etat_code == 'bon' %}bg-green-500{% elif etat_code == 'usage' %}bg-blue-500{% elif etat_code == 'defectueux' %}bg-orange-500{% else %}bg-red-500{% endif %}"></span>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

{% if equipements %}
<!-- Liste des équipements -->
<div class="bg-white rounded-lg border border-gray-200 overflow-hidden">
    <div class="bg-gray-50 px-6 py-4 border-b border-gray-200">
        <h3 class="text-lg font-semibold text-gray-900 font-lato">Liste des Équipements</h3>
    </div>
    
    <!-- Version mobile -->
    <div class="md:hidden divide-y divide-gray-200">
        {% for equipement in equipements %}
        <div class="p-4">
            <div class="flex items-center space-x-3 mb-3">
                {% if equipement.photo %}
                <img src="{{ equipement.photo.url }}" alt="{{ equipement.nom }}" class="w-16 h-16 rounded-lg object-cover">
                {% else %}
                <div class="w-16 h-16 bg-gray-100 rounded-lg flex items-center justify-center">
                    <span class="material-icons text-gray-400">image</span>
                </div>
                {% endif %}
                
                <div class="flex-1">
                    <h4 class="font-semibold text-gray-900 font-lato">{{ equipement.nom }}</h4>
                    <p class="text-sm text-gray-600 font-lato">{{ equipement.prix_achat|floatformat:0 }} FCFA</p>
                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full font-lato
                        {% if equipement.etat == 'bon' %}bg-green-100 text-green-800
                        {% elif equipement.etat == 'usage' %}bg-blue-100 text-blue-800
                        {% elif equipement.etat == 'defectueux' %}bg-orange-100 text-orange-800
                        {% else %}bg-red-100 text-red-800{% endif %}">
                        {{ equipement.get_etat_display }}
                    </span>
                </div>
            </div>
            
            {% if equipement.commentaire %}
            <p class="text-sm text-gray-600 mb-3 font-lato">{{ equipement.commentaire }}</p>
            {% endif %}
            
            <!-- Actions rapides -->
            <div class="flex space-x-2">
                <!-- Changement d'état rapide selon cahier -->
                {% for etat_code, etat_nom in equipement.ETAT_CHOICES %}
                {% if etat_code != equipement.etat %}
                <a href="{% url 'inventaire:changer_etat' equipement.pk %}?etat={{ etat_code }}" 
                   class="flex items-center space-x-1 px-3 py-1 text-xs rounded-full border font-lato
                   {% if etat_code == 'bon' %}border-green-200 text-green-700 hover:bg-green-50
                   {% elif etat_code == 'usage' %}border-blue-200 text-blue-700 hover:bg-blue-50
                   {% elif etat_code == 'defectueux' %}border-orange-200 text-orange-700 hover:bg-orange-50
                   {% else %}border-red-200 text-red-700 hover:bg-red-50{% endif %} transition-colors">
                    <span class="w-2 h-2 rounded-full 
                        {% if etat_code == 'bon' %}bg-green-500
                        {% elif etat_code == 'usage' %}bg-blue-500
                        {% elif etat_code == 'defectueux' %}bg-orange-500
                        {% else %}bg-red-500{% endif %}"></span>
                    <span>{{ etat_nom }}</span>
                </a>
                {% endif %}
                {% endfor %}
            </div>
            
            <div class="flex space-x-2 mt-3">
                <a href="{% url 'inventaire:modifier_equipement' equipement.pk %}" 
                   class="flex items-center space-x-1 px-3 py-1 text-xs text-gray-600 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors font-lato">
                    <span class="material-icons text-xs">edit</span>
                    <span>Modifier</span>
                </a>
                
                <a href="{% url 'inventaire:supprimer_equipement' equipement.pk %}" 
                   class="flex items-center space-x-1 px-3 py-1 text-xs text-red-600 border border-red-200 rounded-lg hover:bg-red-50 transition-colors font-lato">
                    <span class="material-icons text-xs">delete</span>
                    <span>Supprimer</span>
                </a>
            </div>
        </div>
        {% endfor %}
    </div>
    
    <!-- Version desktop -->
    <div class="hidden md:block overflow-x-auto">
        <table class="w-full">
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider font-lato">Équipement</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider font-lato">État</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider font-lato">Prix d'achat</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider font-lato">Date d'achat</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider font-lato">Actions</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-200">
                {% for equipement in equipements %}
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4">
                        <div class="flex items-center space-x-4">
                            {% if equipement.photo %}
                            <img src="{{ equipement.photo.url }}" alt="{{ equipement.nom }}" class="w-16 h-16 rounded-lg object-cover">
                            {% else %}
                            <div class="w-16 h-16 bg-gray-100 rounded-lg flex items-center justify-center">
                                <span class="material-icons text-gray-400">image</span>
                            </div>
                            {% endif %}
                            <div>
                                <div class="font-semibold text-gray-900 font-lato">{{ equipement.nom }}</div>
                                {% if equipement.commentaire %}
                                <div class="text-sm text-gray-500 font-lato">{{ equipement.commentaire|truncatechars:60 }}</div>
                                {% endif %}
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4">
                        <span class="inline-flex px-3 py-1 text-sm font-semibold rounded-full font-lato
                            {% if equipement.etat == 'bon' %}bg-green-100 text-green-800
                            {% elif equipement.etat == 'usage' %}bg-blue-100 text-blue-800
                            {% elif equipement.etat == 'defectueux' %}bg-orange-100 text-orange-800
                            {% else %}bg-red-100 text-red-800{% endif %}">
                            {{ equipement.get_etat_display }}
                        </span>
                    </td>
                    <td class="px-6 py-4 text-sm text-gray-900 font-lato">{{ equipement.prix_achat|floatformat:0 }} FCFA</td>
                    <td class="px-6 py-4 text-sm text-gray-900 font-lato">{{ equipement.date_achat|date:"d/m/Y" }}</td>
                    <td class="px-6 py-4">
                        <div class="flex items-center space-x-2">
                            <!-- Changement d'état rapide selon cahier -->
                            <div class="relative group">
                                <button class="flex items-center space-x-1 px-3 py-2 text-sm text-gray-600 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors font-lato">
                                    <span class="material-icons text-sm">swap_horiz</span>
                                    <span>Changer état</span>
                                </button>
                                <div class="absolute left-0 mt-2 w-48 bg-white border border-gray-200 rounded-lg shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
                                    {% for etat_code, etat_nom in equipement.ETAT_CHOICES %}
                                    <a href="{% url 'inventaire:changer_etat' equipement.pk %}?etat={{ etat_code }}" 
                                       class="flex items-center space-x-3 px-4 py-2 text-gray-600 hover:bg-gray-50 {% if forloop.first %}rounded-t-lg{% elif forloop.last %}rounded-b-lg{% endif %}">
                                        <span class="w-2 h-2 rounded-full 
                                            {% if etat_code == 'bon' %}bg-green-500
                                            {% elif etat_code == 'usage' %}bg-blue-500
                                            {% elif etat_code == 'defectueux' %}bg-orange-500
                                            {% else %}bg-red-500{% endif %}"></span>
                                        <span class="font-lato">{{ etat_nom }}</span>
                                    </a>
                                    {% endfor %}
                                </div>
                            </div>
                            
                            <a href="{% url 'inventaire:modifier_equipement' equipement.pk %}" 
                               class="p-2 text-gray-400 hover:text-[#02066F] transition-colors">
                                <span class="material-icons text-sm">edit</span>
                            </a>
                            
                            <a href="{% url 'inventaire:supprimer_equipement' equipement.pk %}" 
                               class="p-2 text-gray-400 hover:text-red-600 transition-colors">
                                <span class="material-icons text-sm">delete</span>
                            </a>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

{% else %}
<!-- État vide -->
<div class="bg-white rounded-lg border border-gray-200 p-12 text-center">
    <div class="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-6">
        <span class="material-icons text-gray-400 text-3xl">inventory</span>
    </div>
    <h3 class="text-xl font-medium text-gray-900 mb-2 font-lato">
        Aucun équipement
    </h3>
    <p class="text-gray-500 mb-6 font-lato">
        Cet appartement n'a pas encore d'équipements enregistrés.
    </p>
    <a href="{% url 'inventaire:ajouter_equipement' appartement.pk %}" 
       class="inline-flex items-center space-x-2 px-6 py-3 bg-[#02066F] text-white rounded-lg hover:bg-[#030a8a] transition-colors font-lato">
        <span class="material-icons text-sm">add</span>
        <span>Ajouter Premier Équipement</span>
    </a>
</div>
{% endif %}

<!-- Résumé financier -->
<div class="mt-8 bg-gradient-to-r from-[#02066F]/5 to-green-50 rounded-lg p-6 border border-[#02066F]/20">
    <div class="flex items-center justify-between">
        <div>
            <h3 class="text-lg font-semibold text-gray-900 mb-2 font-lato">Valeur Totale de l'Inventaire</h3>
            <p class="text-gray-600 font-lato">Basée sur les prix d'achat selon cahier</p>
        </div>
        <div class="text-right">
            <div class="text-3xl font-bold text-[#02066F] font-lato">{{ valeur_totale|floatformat:0 }}</div>
            <div class="text-[#02066F] font-lato">FCFA</div>
        </div>
    </div>
</div>
{% endblock %}