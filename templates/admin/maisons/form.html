<!-- templates/admin/maisons/form.html -->
{% extends 'admin/base.html' %}

{% block title %}{{ action }} une maison - RepAvi Admin{% endblock %}
{% block page_title %}{{ action }} une maison{% endblock %}

{% block breadcrumb %}
    <nav class="text-sm">
        <ol class="flex items-center space-x-2 text-gray-500">
            <li><a href="{% url 'repavi_admin:dashboard' %}" class="hover:text-gray-700 transition-colors">Tableau de bord</a></li>
            <li><i class="fas fa-chevron-right text-xs"></i></li>
            <li><a href="{% url 'repavi_admin:maisons_list' %}" class="hover:text-gray-700 transition-colors">Maisons</a></li>
            <li><i class="fas fa-chevron-right text-xs"></i></li>
            <li class="text-gray-900 font-medium">{{ action }}</li>
        </ol>
    </nav>
{% endblock %}

{% block content %}
    <div class="max-w-4xl mx-auto">
        <form method="post" class="space-y-8">
            {% csrf_token %}
            
            <!-- Informations générales -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900">
                        <i class="fas fa-info-circle mr-2 text-blue-500"></i>
                        Informations générales
                    </h3>
                    <p class="mt-1 text-sm text-gray-600">
                        Renseignez les informations de base de votre maison.
                    </p>
                </div>
                
                <div class="p-6 space-y-6">
                    <!-- Nom et numéro -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="{{ form.nom.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
                                Nom de la maison <span class="text-red-500">*</span>
                            </label>
                            {{ form.nom }}
                            {% if form.nom.errors %}
                                <div class="mt-1 text-sm text-red-600">
                                    {% for error in form.nom.errors %}
                                        <p>{{ error }}</p>
                                    {% endfor %}
                                </div>
                            {% endif %}
                            <p class="mt-1 text-sm text-gray-500">
                                Le nom qui apparaîtra sur le site
                            </p>
                        </div>
                        
                        <div>
                            <label for="{{ form.numero.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
                                Numéro de la maison <span class="text-red-500">*</span>
                            </label>
                            {{ form.numero }}
                            {% if form.numero.errors %}
                                <div class="mt-1 text-sm text-red-600">
                                    {% for error in form.numero.errors %}
                                        <p>{{ error }}</p>
                                    {% endfor %}
                                </div>
                            {% endif %}
                            <p class="mt-1 text-sm text-gray-500">
                                Numéro d'identification unique (ex: M001)
                            </p>
                        </div>
                    </div>

                    <!-- Slug with regenerate button -->
                    <div>
                        <label for="{{ form.slug.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
                            URL slug
                        </label>
                        <div class="flex space-x-2">
                            {{ form.slug }}
                            <button type="button" id="regenerate-slug" 
                                    class="px-3 py-2 text-sm bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors"
                                    title="Régénérer le slug depuis le nom">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                        {% if form.slug.errors %}
                            <div class="mt-1 text-sm text-red-600">
                                {% for error in form.slug.errors %}
                                    <p>{{ error }}</p>
                                {% endfor %}
                            </div>
                        {% endif %}
                        <p class="mt-1 text-sm text-gray-500">
                            URL de la maison (auto-généré depuis le nom)
                        </p>
                    </div>

                    <!-- Description -->
                    <div>
                        <label for="{{ form.description.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
                            Description <span class="text-red-500">*</span>
                        </label>
                        {{ form.description }}
                        {% if form.description.errors %}
                            <div class="mt-1 text-sm text-red-600">
                                {% for error in form.description.errors %}
                                    <p>{{ error }}</p>
                                {% endfor %}
                            </div>
                        {% endif %}
                        <p class="mt-1 text-sm text-gray-500">
                            Description détaillée de la maison qui apparaîtra aux visiteurs
                        </p>
                    </div>

                    <!-- Localisation with quick action links -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="{{ form.ville.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
                                Ville <span class="text-red-500">*</span>
                            </label>
                            {{ form.ville }}
                            {% if form.ville.errors %}
                                <div class="mt-1 text-sm text-red-600">
                                    {% for error in form.ville.errors %}
                                        <p>{{ error }}</p>
                                    {% endfor %}
                                </div>
                            {% endif %}
                            <!-- Quick action link -->
                            <div class="mt-2">
                                <a href="{% url 'repavi_admin:ville_create' %}" target="_blank"
                                   class="inline-flex items-center text-sm text-blue-600 hover:text-blue-700 transition-colors">
                                    <i class="fas fa-plus mr-1"></i>
                                    Ajouter une nouvelle ville
                                    <i class="fas fa-external-link-alt ml-1 text-xs"></i>
                                </a>
                            </div>
                        </div>
                        
                        <div>
                            <label for="{{ form.adresse.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
                                Adresse <span class="text-red-500">*</span>
                            </label>
                            {{ form.adresse }}
                            {% if form.adresse.errors %}
                                <div class="mt-1 text-sm text-red-600">
                                    {% for error in form.adresse.errors %}
                                        <p>{{ error }}</p>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Catégorie et statut with quick action link -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="{{ form.categorie.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
                                Catégorie
                            </label>
                            {{ form.categorie }}
                            {% if form.categorie.errors %}
                                <div class="mt-1 text-sm text-red-600">
                                    {% for error in form.categorie.errors %}
                                        <p>{{ error }}</p>
                                    {% endfor %}
                                </div>
                            {% endif %}
                            <!-- Quick action link -->
                            <div class="mt-2">
                                <a href="{% url 'repavi_admin:categorie_create' %}" target="_blank"
                                   class="inline-flex items-center text-sm text-emerald-600 hover:text-emerald-700 transition-colors">
                                    <i class="fas fa-plus mr-1"></i>
                                    Créer une nouvelle catégorie
                                    <i class="fas fa-external-link-alt ml-1 text-xs"></i>
                                </a>
                            </div>
                        </div>
                        
                        <div>
                            <label for="{{ form.statut_occupation.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
                                Statut d'occupation <span class="text-red-500">*</span>
                            </label>
                            {{ form.statut_occupation }}
                            {% if form.statut_occupation.errors %}
                                <div class="mt-1 text-sm text-red-600">
                                    {% for error in form.statut_occupation.errors %}
                                        <p>{{ error }}</p>
                                    {% endfor %}
                                </div>
                            {% endif %}
                            <p class="mt-1 text-sm text-gray-500">
                                État actuel de la maison
                            </p>
                        </div>
                    </div>

                    <!-- Gestionnaire (seulement pour super admin) -->
                    {% if is_super_admin %}
                    <div>
                        <label for="{{ form.gestionnaire.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
                            Gestionnaire <span class="text-red-500">*</span>
                        </label>
                        {{ form.gestionnaire }}
                        {% if form.gestionnaire.errors %}
                            <div class="mt-1 text-sm text-red-600">
                                {% for error in form.gestionnaire.errors %}
                                    <p>{{ error }}</p>
                                {% endfor %}
                            </div>
                        {% endif %}
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Caractéristiques -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900">
                        <i class="fas fa-ruler-combined mr-2 text-emerald-500"></i>
                        Caractéristiques
                    </h3>
                    <p class="mt-1 text-sm text-gray-600">
                        Détails techniques et capacité de la maison.
                    </p>
                </div>
                
                <div class="p-6 space-y-6">
                    <!-- Capacité et chambres -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                        <div>
                            <label for="{{ form.capacite_personnes.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
                                Capacité <span class="text-red-500">*</span>
                            </label>
                            {{ form.capacite_personnes }}
                            {% if form.capacite_personnes.errors %}
                                <div class="mt-1 text-sm text-red-600">
                                    {% for error in form.capacite_personnes.errors %}
                                        <p>{{ error }}</p>
                                    {% endfor %}
                                </div>
                            {% endif %}
                            <p class="mt-1 text-xs text-gray-500">Personnes</p>
                        </div>
                        
                        <div>
                            <label for="{{ form.nombre_chambres.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
                                Chambres <span class="text-red-500">*</span>
                            </label>
                            {{ form.nombre_chambres }}
                            {% if form.nombre_chambres.errors %}
                                <div class="mt-1 text-sm text-red-600">
                                    {% for error in form.nombre_chambres.errors %}
                                        <p>{{ error }}</p>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div>
                            <label for="{{ form.nombre_salles_bain.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
                                Salles de bain <span class="text-red-500">*</span>
                            </label>
                            {{ form.nombre_salles_bain }}
                            {% if form.nombre_salles_bain.errors %}
                                <div class="mt-1 text-sm text-red-600">
                                    {% for error in form.nombre_salles_bain.errors %}
                                        <p>{{ error }}</p>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div>
                            <label for="{{ form.superficie.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
                                Superficie <span class="text-red-500">*</span>
                            </label>
                            {{ form.superficie }}
                            {% if form.superficie.errors %}
                                <div class="mt-1 text-sm text-red-600">
                                    {% for error in form.superficie.errors %}
                                        <p>{{ error }}</p>
                                    {% endfor %}
                                </div>
                            {% endif %}
                            <p class="mt-1 text-xs text-gray-500">m²</p>
                        </div>
                    </div>

                    <!-- Prix -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="{{ form.prix_par_nuit.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
                                Prix par nuit <span class="text-red-500">*</span>
                            </label>
                            <div class="relative">
                                {{ form.prix_par_nuit }}
                                <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                                    <span class="text-gray-500 text-sm">FCFA</span>
                                </div>
                            </div>
                            {% if form.prix_par_nuit.errors %}
                                <div class="mt-1 text-sm text-red-600">
                                    {% for error in form.prix_par_nuit.errors %}
                                        <p>{{ error }}</p>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Équipements -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900">
                        <i class="fas fa-cogs mr-2 text-purple-500"></i>
                        Équipements et services
                    </h3>
                    <p class="mt-1 text-sm text-gray-600">
                        Sélectionnez les équipements disponibles dans cette maison.
                    </p>
                </div>
                
                <div class="p-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <!-- WiFi -->
                        <div class="flex items-center p-4 border border-gray-200 rounded-lg hover:bg-gray-50">
                            {{ form.wifi }}
                            <label for="{{ form.wifi.id_for_label }}" class="ml-3 flex items-center cursor-pointer">
                                <i class="fas fa-wifi text-blue-500 mr-2"></i>
                                <div>
                                    <div class="text-sm font-medium text-gray-900">WiFi</div>
                                    <div class="text-xs text-gray-500">Connexion internet</div>
                                </div>
                            </label>
                        </div>

                        <!-- Parking -->
                        <div class="flex items-center p-4 border border-gray-200 rounded-lg hover:bg-gray-50">
                            {{ form.parking }}
                            <label for="{{ form.parking.id_for_label }}" class="ml-3 flex items-center cursor-pointer">
                                <i class="fas fa-car text-gray-500 mr-2"></i>
                                <div>
                                    <div class="text-sm font-medium text-gray-900">Parking</div>
                                    <div class="text-xs text-gray-500">Place de stationnement</div>
                                </div>
                            </label>
                        </div>

                        <!-- Piscine -->
                        <div class="flex items-center p-4 border border-gray-200 rounded-lg hover:bg-gray-50">
                            {{ form.piscine }}
                            <label for="{{ form.piscine.id_for_label }}" class="ml-3 flex items-center cursor-pointer">
                                <i class="fas fa-swimming-pool text-blue-500 mr-2"></i>
                                <div>
                                    <div class="text-sm font-medium text-gray-900">Piscine</div>
                                    <div class="text-xs text-gray-500">Accès piscine</div>
                                </div>
                            </label>
                        </div>

                        <!-- Jardin -->
                        <div class="flex items-center p-4 border border-gray-200 rounded-lg hover:bg-gray-50">
                            {{ form.jardin }}
                            <label for="{{ form.jardin.id_for_label }}" class="ml-3 flex items-center cursor-pointer">
                                <i class="fas fa-tree text-emerald-500 mr-2"></i>
                                <div>
                                    <div class="text-sm font-medium text-gray-900">Jardin</div>
                                    <div class="text-xs text-gray-500">Espace extérieur</div>
                                </div>
                            </label>
                        </div>

                        <!-- Climatisation -->
                        <div class="flex items-center p-4 border border-gray-200 rounded-lg hover:bg-gray-50">
                            {{ form.climatisation }}
                            <label for="{{ form.climatisation.id_for_label }}" class="ml-3 flex items-center cursor-pointer">
                                <i class="fas fa-snowflake text-cyan-500 mr-2"></i>
                                <div>
                                    <div class="text-sm font-medium text-gray-900">Climatisation</div>
                                    <div class="text-xs text-gray-500">Air conditionné</div>
                                </div>
                            </label>
                        </div>

                        <!-- Lave-vaisselle -->
                        <div class="flex items-center p-4 border border-gray-200 rounded-lg hover:bg-gray-50">
                            {{ form.lave_vaisselle }}
                            <label for="{{ form.lave_vaisselle.id_for_label }}" class="ml-3 flex items-center cursor-pointer">
                                <i class="fas fa-utensils text-indigo-500 mr-2"></i>
                                <div>
                                    <div class="text-sm font-medium text-gray-900">Lave-vaisselle</div>
                                    <div class="text-xs text-gray-500">Électroménager</div>
                                </div>
                            </label>
                        </div>

                        <!-- Machine à laver -->
                        <div class="flex items-center p-4 border border-gray-200 rounded-lg hover:bg-gray-50">
                            {{ form.machine_laver }}
                            <label for="{{ form.machine_laver.id_for_label }}" class="ml-3 flex items-center cursor-pointer">
                                <i class="fas fa-tshirt text-purple-500 mr-2"></i>
                                <div>
                                    <div class="text-sm font-medium text-gray-900">Machine à laver</div>
                                    <div class="text-xs text-gray-500">Lave-linge</div>
                                </div>
                            </label>
                        </div>

                        <!-- Balcon -->
                        <div class="flex items-center p-4 border border-gray-200 rounded-lg hover:bg-gray-50">
                            {{ form.balcon }}
                            <label for="{{ form.balcon.id_for_label }}" class="ml-3 flex items-center cursor-pointer">
                                <i class="fas fa-building text-amber-500 mr-2"></i>
                                <div>
                                    <div class="text-sm font-medium text-gray-900">Balcon</div>
                                    <div class="text-xs text-gray-500">Espace extérieur couvert</div>
                                </div>
                            </label>
                        </div>

                        <!-- Terrasse -->
                        <div class="flex items-center p-4 border border-gray-200 rounded-lg hover:bg-gray-50">
                            {{ form.terrasse }}
                            <label for="{{ form.terrasse.id_for_label }}" class="ml-3 flex items-center cursor-pointer">
                                <i class="fas fa-home text-emerald-600 mr-2"></i>
                                <div>
                                    <div class="text-sm font-medium text-gray-900">Terrasse</div>
                                    <div class="text-xs text-gray-500">Espace extérieur ouvert</div>
                                </div>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Options -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-medium text-gray-900">
                        <i class="fas fa-toggle-on mr-2 text-amber-500"></i>
                        Options de publication
                    </h3>
                    <p class="mt-1 text-sm text-gray-600">
                        Paramètres de visibilité et de mise en avant.
                    </p>
                </div>
                
                <div class="p-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Disponible -->
                        <div class="flex items-center p-4 border border-gray-200 rounded-lg hover:bg-gray-50">
                            {{ form.disponible }}
                            <label for="{{ form.disponible.id_for_label }}" class="ml-3 flex items-center cursor-pointer">
                                <i class="fas fa-eye text-emerald-500 mr-2"></i>
                                <div>
                                    <div class="text-sm font-medium text-gray-900">Disponible</div>
                                    <div class="text-xs text-gray-500">Visible sur le site et réservable</div>
                                </div>
                            </label>
                        </div>

                        <!-- Featured -->
                        <div class="flex items-center p-4 border border-gray-200 rounded-lg hover:bg-gray-50">
                            {{ form.featured }}
                            <label for="{{ form.featured.id_for_label }}" class="ml-3 flex items-center cursor-pointer">
                                <i class="fas fa-star text-amber-500 mr-2"></i>
                                <div>
                                    <div class="text-sm font-medium text-gray-900">Featured</div>
                                    <div class="text-xs text-gray-500">Mise en avant sur la page d'accueil</div>
                                </div>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Messages d'erreur généraux -->
            {% if form.non_field_errors %}
                <div class="bg-red-50 border border-red-200 rounded-xl p-6">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <i class="fas fa-exclamation-circle text-red-400 text-xl"></i>
                        </div>
                        <div class="ml-3">
                            <h3 class="text-sm font-medium text-red-800">
                                Erreurs dans le formulaire
                            </h3>
                            <div class="mt-2 text-sm text-red-700">
                                {% for error in form.non_field_errors %}
                                    <p>{{ error }}</p>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>
            {% endif %}

            <!-- Boutons d'action -->
            <div class="flex items-center justify-between">
                <a href="{% url 'repavi_admin:maisons_list' %}" 
                   class="inline-flex items-center px-6 py-3 border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition-colors">
                    <i class="fas fa-arrow-left mr-2"></i>
                    Retour à la liste
                </a>
                
                <button type="submit" 
                        class="inline-flex items-center px-6 py-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200 shadow-sm hover:shadow-md">
                    <i class="fas fa-save mr-2"></i>
                    {% if action == "Créer" %}
                        Créer la maison
                    {% else %}
                        Enregistrer les modifications
                    {% endif %}
                </button>
            </div>
        </form>

        <!-- Informations supplémentaires pour modification -->
        {% if action == "Modifier" and objet %}
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 mt-8">
            <div class="px-6 py-4 border-b border-gray-200">
                <h3 class="text-lg font-medium text-gray-900">Informations supplémentaires</h3>
            </div>
            <div class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="text-center p-4 bg-gray-50 rounded-xl">
                        <div class="text-2xl font-bold text-gray-900">{{ objet.photos.count }}</div>
                        <div class="text-sm text-gray-600 mb-2">Photos</div>
                        {% url 'repavi_admin:photos_list' as photos_url %}
                        {% if photos_url %}
                            <a href="{{ photos_url }}?maison={{ objet.pk }}" 
                               class="text-sm text-blue-600 hover:text-blue-700 font-medium">
                                Gérer les photos <i class="fas fa-arrow-right ml-1"></i>
                            </a>
                        {% else %}
                            <span class="text-sm text-gray-500">Gestion des photos</span>
                        {% endif %}
                    </div>
                    <div class="text-center p-4 bg-gray-50 rounded-xl">
                        <div class="text-2xl font-bold text-gray-900">{{ objet.reservations.count|default:0 }}</div>
                        <div class="text-sm text-gray-600 mb-2">Réservations</div>
                        {% if reservations_available and objet.reservations.count %}
                            {% url 'reservations:mes_reservations' as reservations_url %}
                            {% if reservations_url %}
                                <a href="{{ reservations_url }}?maison={{ objet.pk }}" 
                                   class="text-sm text-blue-600 hover:text-blue-700 font-medium">
                                    Voir les réservations <i class="fas fa-arrow-right ml-1"></i>
                                </a>
                            {% else %}
                                <span class="text-sm text-gray-500">Voir les réservations</span>
                            {% endif %}
                        {% else %}
                            <span class="text-sm text-gray-500">Aucune réservation</span>
                        {% endif %}
                    </div>
                    <div class="text-center p-4 bg-gray-50 rounded-xl">
                        <div class="text-sm text-gray-600 mb-2">Page publique</div>
                        <a href="{{ objet.get_absolute_url }}" target="_blank"
                           class="inline-flex items-center text-blue-600 hover:text-blue-700 font-medium">
                            Voir sur le site <i class="fas fa-external-link-alt ml-1"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
{% endblock %}

{% block extra_css %}
<style>
    /* Custom form styling */
    .form-control {
        width: 100%;
        padding: 0.5rem 0.75rem;
        border: 1px solid #d1d5db;
        border-radius: 0.5rem;
        font-size: 0.875rem;
        line-height: 1.25rem;
        transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
    }
    
    .form-control:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    
    textarea.form-control {
        min-height: 100px;
        resize: vertical;
    }

    /* Enhanced checkbox styling */
    input[type="checkbox"] {
        appearance: none;
        width: 1.25rem;
        height: 1.25rem;
        border: 2px solid #d1d5db;
        border-radius: 0.375rem;
        background-color: white;
        cursor: pointer;
        position: relative;
        transition: all 0.15s ease-in-out;
        flex-shrink: 0;
    }

    input[type="checkbox"]:checked {
        background-color: #3b82f6;
        border-color: #3b82f6;
    }

    input[type="checkbox"]:checked::after {
        content: '\2713';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-size: 0.875rem;
        font-weight: bold;
    }

    input[type="checkbox"]:focus {
        outline: 2px solid #3b82f6;
        outline-offset: 2px;
    }

    /* Button animations */
    @keyframes pulse {
        0%, 100% { transform: rotate(0deg); }
        50% { transform: rotate(180deg); }
    }
    
    .animate-pulse-rotate {
        animation: pulse 1s ease-in-out;
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const nameInput = document.querySelector('input[name*="nom"]');
        const slugInput = document.querySelector('input[name*="slug"]');
        const numeroInput = document.querySelector('input[name*="numero"]');
        const regenerateBtn = document.getElementById('regenerate-slug');
        
        // Enhanced slug generation function
        function generateSlug(text) {
            return text
                .toLowerCase()
                .normalize("NFD")
                .replace(/[\u0300-\u036f]/g, "")
                .replace(/[^a-z0-9\s]/g, '')
                .trim()
                .replace(/\s+/g, '-')
                .replace(/-+/g, '-')
                .replace(/^-|-$/g, '');
        }
        
        // Auto-generate slug from name
        nameInput.addEventListener('input', function() {
            if (slugInput && !slugInput.value) {
                const slug = generateSlug(this.value);
                slugInput.value = slug;
            }
        });
        
        // Regenerate slug button functionality
        regenerateBtn.addEventListener('click', function() {
            if (nameInput.value) {
                const slug = generateSlug(nameInput.value);
                slugInput.value = slug;
                
                // Add visual feedback
                this.classList.add('animate-pulse-rotate');
                setTimeout(() => {
                    this.classList.remove('animate-pulse-rotate');
                }, 1000);
                
                // Show brief success message
                const originalText = this.innerHTML;
                this.innerHTML = '<i class="fas fa-check text-green-600"></i>';
                setTimeout(() => {
                    this.innerHTML = originalText;
                }, 1000);
            } else {
                // Show warning if no name
                const originalText = this.innerHTML;
                this.innerHTML = '<i class="fas fa-exclamation text-red-600"></i>';
                setTimeout(() => {
                    this.innerHTML = originalText;
                }, 1000);
            }
        });

        // Auto-generate number from name
        nameInput.addEventListener('input', function() {
            if (numeroInput && !numeroInput.value) {
                const nom = this.value.trim();
                if (nom.length >= 2) {
                    const prefix = nom.substring(0, 2).toUpperCase();
                    const timestamp = Date.now().toString().slice(-3);
                    numeroInput.value = `${prefix}${timestamp}`;
                }
            }
        });

        // Form validation with enhanced UX
        function validateForm() {
            const requiredFields = document.querySelectorAll('input[required], select[required], textarea[required]');
            const submitBtn = document.querySelector('button[type="submit"]');
            let isValid = true;

            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    isValid = false;
                }
            });

            if (submitBtn) {
                submitBtn.disabled = !isValid;
                if (!isValid) {
                    submitBtn.classList.add('opacity-50', 'cursor-not-allowed');
                } else {
                    submitBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                }
            }
        }

        // Real-time validation
        document.querySelectorAll('input, select, textarea').forEach(field => {
            field.addEventListener('input', validateForm);
            field.addEventListener('change', validateForm);
        });

        // Price formatting
        const prixField = document.querySelector('input[name*="prix_par_nuit"]');
        if (prixField) {
            prixField.addEventListener('blur', function() {
                const value = parseFloat(this.value);
                if (!isNaN(value)) {
                    this.value = value.toFixed(2);
                }
            });
        }

        // Enhanced validation rules
        const superficieField = document.querySelector('input[name*="superficie"]');
        if (superficieField) {
            superficieField.addEventListener('input', function() {
                const value = parseInt(this.value);
                if (value && value < 10) {
                    this.setCustomValidity('La superficie doit être d\'au moins 10 m²');
                } else {
                    this.setCustomValidity('');
                }
            });
        }

        // Capacity vs rooms validation
        const capaciteField = document.querySelector('input[name*="capacite_personnes"]');
        const chambresField = document.querySelector('input[name*="nombre_chambres"]');
        
        function validateCapacity() {
            if (capaciteField && chambresField) {
                const capacite = parseInt(capaciteField.value);
                const chambres = parseInt(chambresField.value);
                
                if (capacite && chambres && capacite < chambres) {
                    capaciteField.setCustomValidity('La capacité ne peut pas être inférieure au nombre de chambres');
                } else {
                    capaciteField.setCustomValidity('');
                }
            }
        }

        if (capaciteField) capaciteField.addEventListener('input', validateCapacity);
        if (chambresField) chambresField.addEventListener('input', validateCapacity);

        // Number format validation
        const numeroField = document.querySelector('input[name*="numero"]');
        if (numeroField) {
            numeroField.addEventListener('input', function() {
                const value = this.value.trim();
                const validFormat = /^[A-Za-z0-9-]+$/.test(value);
                
                if (value && !validFormat) {
                    this.setCustomValidity('Le numéro ne peut contenir que des lettres, chiffres et tirets');
                } else {
                    this.setCustomValidity('');
                }
            });
        }

        // Initial validation
        validateForm();

        // Handle new window creation notifications for quick actions
        let newWindowOpened = false;
        
        window.addEventListener('focus', function() {
            if (newWindowOpened) {
                setTimeout(() => {
                    location.reload(); // Reload to update select options
                }, 1000);
                newWindowOpened = false;
            }
        });
        
        document.querySelectorAll('a[target="_blank"]').forEach(link => {
            link.addEventListener('click', function() {
                newWindowOpened = true;
            });
        });

        // Unsaved changes warning
        let formChanged = false;
        
        document.querySelectorAll('input, select, textarea').forEach(field => {
            field.addEventListener('input', () => {
                formChanged = true;
            });
        });

        window.addEventListener('beforeunload', function(e) {
            if (formChanged) {
                e.preventDefault();
                e.returnValue = '';
            }
        });

        document.querySelector('form').addEventListener('submit', () => {
            formChanged = false;
        });
    });
</script>
{% endblock %}