{% load static %}
<!DOCTYPE html>
<html lang="fr" class="h-full bg-gray-50">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Administration RepAvi{% endblock %}</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" referrerpolicy="no-referrer" />

    <link rel="icon" type="image/png" href="{% static '' %}">
    <!-- Tailwind CSS (build local, pas CDN) -->
    <!-- <link href="{% static 'css/tailwind.css' %}" rel="stylesheet"> -->
  <link rel="stylesheet" type="text/css" href="{% static 'css/dist/styles.css' %}">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Font Awesome -->

    <!-- Chart.js pour les graphiques -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>

    <style>
        body {
            font-family: 'Lato', 'Inter', sans-serif;
        }

        .sidebar-link.active {
            background-color: #3b82f6;
            color: white;
        }

        .sidebar-link:hover {
            background-color: #e5e7eb;
        }

        .sidebar-link.active:hover {
            background-color: #2563eb;
        }

        .card-hover {
            transition: all 0.3s ease;
        }

        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>

    {% block extra_css %}{% endblock %}
</head>

<body class="bg-gray-100">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <a href="{% url 'repavi_admin:dashboard' %}" class="text-xl font-bold text-blue-600">
                        <i class="fas fa-home mr-2"></i>RepAvi Admin
                    </a>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-2">
                        <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                            <i class="fas fa-user text-blue-600 text-sm"></i>
                        </div>
                        <span class="text-gray-700">{{ user.first_name|default:user.username }}</span>
                    </div>
                    <div class="border-l border-gray-300 pl-4">
                        <a href="{% url 'home:index' %}" class="text-gray-500 hover:text-gray-700 text-sm">
                            <i class="fas fa-external-link-alt mr-1"></i>Voir le site
                        </a>
                    </div>
                    <div class="border-l border-gray-300 pl-4">
                        <a href="{% url 'users:logout' %}" class="text-red-500 hover:text-red-700 text-sm">
                            <i class="fas fa-sign-out-alt mr-1"></i>Déconnexion
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Layout principal -->
    <div class="flex">
        <!-- Sidebar -->
        <aside class="w-64 bg-white shadow-sm min-h-screen">
            <nav class="mt-5 px-2 space-y-1">
                <!-- Dashboard principal -->
                <a href="{% url 'repavi_admin:dashboard' %}"
                    class="group flex items-center px-3 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-blue-50 hover:text-blue-600 transition-colors">
                    <i class="fas fa-chart-line mr-3 w-5"></i>
                    Dashboard
                </a>

                <!-- Section Propriétés -->
                <div class="pt-4">
                    <p class="px-3 text-xs font-semibold text-gray-400 uppercase tracking-wider">Propriétés</p>

                    <a href="{% url 'repavi_admin:maisons_list' %}"
                        class="group flex items-center px-3 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-blue-50 hover:text-blue-600 transition-colors mt-2">
                        <i class="fas fa-home mr-3 w-5"></i>
                        Maisons
                    </a>

                    <a href="{% url 'repavi_admin:villes_list' %}"
                        class="group flex items-center px-3 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-blue-50 hover:text-blue-600 transition-colors">
                        <i class="fas fa-map-marker-alt mr-3 w-5"></i>
                        Villes
                    </a>

                    <a href="{% url 'repavi_admin:categories_list' %}"
                        class="group flex items-center px-3 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-blue-50 hover:text-blue-600 transition-colors">
                        <i class="fas fa-tags mr-3 w-5"></i>
                        Catégories
                    </a>

                    <a href="{% url 'repavi_admin:photos_list' %}"
                        class="group flex items-center px-3 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-blue-50 hover:text-blue-600 transition-colors">
                        <i class="fas fa-camera mr-3 w-5"></i>
                        Photos
                    </a>
                </div>

                <!-- Section Gestion -->
                <div class="pt-4">
                    <p class="px-3 text-xs font-semibold text-gray-400 uppercase tracking-wider">Gestion</p>

                    <a href="{% url 'meubles:dashboard' %}"
                        class="group flex items-center px-3 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-green-50 hover:text-green-600 transition-colors mt-2">
                        <i class="fas fa-couch mr-3 w-5"></i>
                        Meubles
                        <span class="ml-auto bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">
                            <i class="fas fa-star text-xs"></i>
                        </span>
                    </a>

                    <a href="{% url 'reservations:dashboard' %}"
                        class="group flex items-center px-3 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-blue-50 hover:text-blue-600 transition-colors">
                        <i class="fas fa-calendar-check mr-3 w-5"></i>
                        Réservations
                        <span class="ml-auto bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full">
                            <i class="fas fa-bolt text-xs"></i>
                        </span>
                    </a>
                </div>
                <!-- Section Administration (super admin seulement) -->
                {% if user.is_superuser or user.role == 'SUPER_ADMIN' %}
                <div class="border-t border-gray-200 pt-4 mt-4">
                    <p class="px-3 text-xs font-semibold text-gray-400 uppercase tracking-wider">Administration</p>

                    <a href="{% url 'repavi_admin:admin_users_list' %}"
                        class="group flex items-center px-3 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-purple-50 hover:text-purple-600 transition-colors mt-2">
                        <i class="fas fa-users mr-3 w-5"></i>
                        Utilisateurs
                    </a>

                    <a href="/admin/"
                        class="group flex items-center px-3 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-purple-50 hover:text-purple-600 transition-colors">
                        <i class="fas fa-cogs mr-3 w-5"></i>
                        Admin Django
                    </a>

                    <a href="{% url 'meubles:generer_rapport' %}"
                        class="group flex items-center px-3 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-purple-50 hover:text-purple-600 transition-colors">
                        <i class="fas fa-chart-bar mr-3 w-5"></i>
                        Rapports
                    </a>
                </div>
                {% endif %}

                <!-- Section Raccourcis -->
                <div class="pt-4">
                    <p class="px-3 text-xs font-semibold text-gray-400 uppercase tracking-wider">Actions Rapides</p>

                    <a href="{% url 'meubles:meuble_create' %}"
                        class="group flex items-center px-3 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-indigo-50 hover:text-indigo-600 transition-colors mt-2">
                        <i class="fas fa-plus mr-3 w-5"></i>
                        Nouveau Meuble
                    </a>

                    <a href="{% url 'meubles:inventaire_create' %}"
                        class="group flex items-center px-3 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-indigo-50 hover:text-indigo-600 transition-colors">
                        <i class="fas fa-clipboard-list mr-3 w-5"></i>
                        Nouvel Inventaire
                    </a>
                </div>
            </nav>
        </aside>

        <!-- Contenu principal -->
        <main class="flex-1 min-h-screen">
            <!-- En-tête de page -->
            <header class="bg-white shadow-sm border-b border-gray-200 px-6 py-4">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-2xl font-bold text-gray-900">
                            {% block page_title %}RepAvi Admin{% endblock %}
                        </h1>
                        {% block breadcrumb %}{% endblock %}
                    </div>
                    <div class="flex items-center space-x-3">
                        {% block header_actions %}
                        <!-- Actions par défaut -->
                        <a href="{% url 'meubles:dashboard' %}"
                            class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors">
                            <i class="fas fa-couch mr-2"></i>
                            Meubles
                        </a>
                        {% endblock %}
                    </div>
                </div>
            </header>

            <!-- Messages -->
            {% if messages %}
            <div class="px-6 py-4">
                {% for message in messages %}
                <div class="alert alert-{{ message.tags }} mb-3 p-4 border rounded-lg flex items-center fade-in
                        {% if message.tags == 'success' %}bg-green-50 border-green-200 text-green-800
                        {% elif message.tags == 'error' %}bg-red-50 border-red-200 text-red-800
                        {% elif message.tags == 'warning' %}bg-yellow-50 border-yellow-200 text-yellow-800
                        {% else %}bg-blue-50 border-blue-200 text-blue-800{% endif %}">
                    <i
                        class="fas fa-{% if message.tags == 'success' %}check-circle{% elif message.tags == 'error' %}exclamation-circle{% elif message.tags == 'warning' %}exclamation-triangle{% else %}info-circle{% endif %} mr-3"></i>
                    <span>{{ message }}</span>
                    <button onclick="this.parentElement.remove()" class="ml-auto text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                {% endfor %}
            </div>
            {% endif %}

            <!-- Contenu de la page -->
            <div class="px-6 py-6">
                {% block content %}
                <!-- Dashboard par défaut avec widget meubles -->
                <div class="space-y-6">
                    <!-- Cartes de statistiques -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <!-- Widget Meubles -->
                        <div class="bg-gradient-to-r from-green-500 to-green-600 rounded-xl p-6 text-white card-hover">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <i class="fas fa-couch text-3xl opacity-80"></i>
                                </div>
                                <div class="ml-4">
                                    <div class="text-2xl font-bold">{{ total_meubles|default:0 }}</div>
                                    <div class="text-sm opacity-90">Meubles Total</div>
                                    <a href="{% url 'meubles:dashboard' %}"
                                        class="text-xs underline opacity-75 hover:opacity-100">
                                        Voir détails →
                                    </a>
                                </div>
                            </div>
                        </div>

                        <!-- Widget Maisons -->
                        <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl p-6 text-white card-hover">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <i class="fas fa-home text-3xl opacity-80"></i>
                                </div>
                                <div class="ml-4">
                                    <div class="text-2xl font-bold">{{ total_maisons|default:0 }}</div>
                                    <div class="text-sm opacity-90">Maisons</div>
                                    <a href="{% url 'repavi_admin:maisons_list' %}"
                                        class="text-xs underline opacity-75 hover:opacity-100">
                                        Gérer →
                                    </a>
                                </div>
                            </div>
                        </div>

                        <!-- Widget Réservations -->
                        <div
                            class="bg-gradient-to-r from-orange-500 to-orange-600 rounded-xl p-6 text-white card-hover">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <i class="fas fa-calendar-check text-3xl opacity-80"></i>
                                </div>
                                <div class="ml-4">
                                    <div class="text-2xl font-bold">{{ total_reservations|default:0 }}</div>
                                    <div class="text-sm opacity-90">Réservations</div>
                                    <a href="{% url 'reservations:mes_reservations' %}"
                                        class="text-xs underline opacity-75 hover:opacity-100">
                                        Voir toutes →
                                    </a>
                                </div>
                            </div>
                        </div>

                        <!-- Widget Villes -->
                        <div
                            class="bg-gradient-to-r from-purple-500 to-purple-600 rounded-xl p-6 text-white card-hover">
                            <div class="flex items-center">
                                <div class="flex-shrink-0">
                                    <i class="fas fa-map-marker-alt text-3xl opacity-80"></i>
                                </div>
                                <div class="ml-4">
                                    <div class="text-2xl font-bold">{{ total_villes|default:0 }}</div>
                                    <div class="text-sm opacity-90">Villes</div>
                                    <a href="{% url 'repavi_admin:villes_list' %}"
                                        class="text-xs underline opacity-75 hover:opacity-100">
                                        Gérer →
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Actions rapides -->
                    <div class="bg-white rounded-xl shadow-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">
                            <i class="fas fa-bolt text-indigo-600 mr-2"></i>
                            Actions Rapides
                        </h3>

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <a href="{% url 'meubles:dashboard' %}"
                                class="flex items-center p-4 bg-green-50 rounded-lg hover:bg-green-100 transition-colors group">
                                <div class="flex-shrink-0">
                                    <i class="fas fa-tachometer-alt text-green-600 text-xl"></i>
                                </div>
                                <div class="ml-4">
                                    <div class="text-sm font-medium text-gray-900 group-hover:text-green-700">
                                        Dashboard Meubles
                                    </div>
                                    <div class="text-xs text-gray-500">
                                        Statistiques et gestion
                                    </div>
                                </div>
                            </a>

                            <a href="{% url 'meubles:meuble_create' %}"
                                class="flex items-center p-4 bg-blue-50 rounded-lg hover:bg-blue-100 transition-colors group">
                                <div class="flex-shrink-0">
                                    <i class="fas fa-plus text-blue-600 text-xl"></i>
                                </div>
                                <div class="ml-4">
                                    <div class="text-sm font-medium text-gray-900 group-hover:text-blue-700">
                                        Nouveau Meuble
                                    </div>
                                    <div class="text-xs text-gray-500">
                                        Ajouter à l'inventaire
                                    </div>
                                </div>
                            </a>

                            <a href="{% url 'meubles:inventaire_create' %}"
                                class="flex items-center p-4 bg-purple-50 rounded-lg hover:bg-purple-100 transition-colors group">
                                <div class="flex-shrink-0">
                                    <i class="fas fa-clipboard-list text-purple-600 text-xl"></i>
                                </div>
                                <div class="ml-4">
                                    <div class="text-sm font-medium text-gray-900 group-hover:text-purple-700">
                                        Nouvel Inventaire
                                    </div>
                                    <div class="text-xs text-gray-500">
                                        État des lieux
                                    </div>
                                </div>
                            </a>
                        </div>
                    </div>

                    <!-- Widget d'aperçu des meubles défectueux -->
                    {% if meubles_defectueux %}
                    <div class="bg-red-50 border border-red-200 rounded-xl p-6">
                        <div class="flex items-start">
                            <div class="flex-shrink-0">
                                <i class="fas fa-exclamation-triangle text-red-600 text-xl"></i>
                            </div>
                            <div class="ml-3">
                                <h3 class="text-sm font-medium text-red-800">Attention Requise</h3>
                                <div class="mt-2 text-sm text-red-700">
                                    <p>{{ meubles_defectueux|length }} meuble{{ meubles_defectueux|length|pluralize }}
                                        défectueux détecté{{ meubles_defectueux|length|pluralize }}.</p>
                                    <a href="{% url 'meubles:meubles_list' %}?etat=defectueux"
                                        class="underline font-medium">
                                        Voir la liste complète →
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
                {% endblock %}
            </div>
        </main>
    </div>

    <!-- Scripts globaux -->
    <script>
        // Gestion du menu actif
        document.addEventListener('DOMContentLoaded', function () {
            const currentPath = window.location.pathname;
            const menuLinks = document.querySelectorAll('aside nav a');

            menuLinks.forEach(link => {
                const href = link.getAttribute('href');
                if (currentPath.startsWith(href) && href !== '/repavi-admin/') {
                    link.classList.add('bg-blue-50', 'text-blue-600');
                    link.classList.remove('text-gray-600');
                } else if (currentPath === '/repavi-admin/' && href.includes('dashboard')) {
                    link.classList.add('bg-blue-50', 'text-blue-600');
                    link.classList.remove('text-gray-600');
                }

                // Highlight spécial pour les meubles
                if (href.includes('meubles') && currentPath.includes('meubles')) {
                    link.classList.add('bg-green-50', 'text-green-600');
                    link.classList.remove('text-gray-600', 'bg-blue-50', 'text-blue-600');
                }
            });
        });

        // Auto-hide des messages après 5 secondes
        setTimeout(function () {
            const alerts = document.querySelectorAll('.alert');
            alerts.forEach(alert => {
                alert.style.transition = 'opacity 0.5s ease-out';
                alert.style.opacity = '0';
                setTimeout(() => alert.remove(), 500);
            });
        }, 2000);

        // Animation des cartes au chargement
        document.addEventListener('DOMContentLoaded', function () {
            const cards = document.querySelectorAll('.card-hover');
            cards.forEach((card, index) => {
                setTimeout(() => {
                    card.classList.add('fade-in');
                }, index * 100);
            });
        });
    </script>

    {% block extra_js %}{% endblock %}
</body>

</html>