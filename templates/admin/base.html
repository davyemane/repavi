{% load static %}
<!DOCTYPE html>
<html lang="fr" class="h-full bg-gray-50">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Administration RepAvi - Gestion des meubles et propriétés">
    <title>{% block title %}Administration RepAvi{% endblock %}</title>
    
    <!-- Preload critical resources -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" as="style">
    
    <!-- Icons and Favicon -->
    <link rel="icon" type="image/png" href="{% static 'favicon.ico' %}">
    <link rel="shortcut icon" href="{% static 'images/logo3.svg' %}" type="image/x-icon">
    
    <!-- External CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" 
          integrity="sha512-..." crossorigin="anonymous" referrerpolicy="no-referrer">
    
    <!-- Tailwind CSS -->
    <link rel="stylesheet" type="text/css" href="{% static 'css/dist/styles.css' %}">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Chart.js for dashboard -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js" defer></script>

    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }

        /* Sidebar animations and states */
        .sidebar {
            transition: all 0.3s ease-in-out;
        }

        .sidebar.collapsed {
            width: 4rem;
        }

        .sidebar-content {
            transition: all 0.3s ease-in-out;
            opacity: 1;
        }

        .sidebar.collapsed .sidebar-content {
            opacity: 0;
        }

        .sidebar.collapsed .sidebar-icon-only {
            opacity: 1;
        }

        .sidebar-icon-only {
            opacity: 0;
            transition: all 0.3s ease-in-out;
        }

        /* Submenu animations */
        .submenu {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-in-out;
        }

        .submenu.active {
            max-height: 500px;
        }

        /* Tooltip for collapsed sidebar */
        .tooltip {
            position: absolute;
            left: 4.5rem;
            background-color: #1f2937;
            color: white;
            padding: 0.5rem 0.75rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease-in-out;
            z-index: 1000;
            white-space: nowrap;
            pointer-events: none;
        }

        .sidebar.collapsed .sidebar-link:hover .tooltip {
            opacity: 1;
            visibility: visible;
        }

        /* Animations */
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Mobile sidebar */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease-in-out;
            }

            .sidebar.mobile-open {
                transform: translateX(0);
            }
        }

        /* Focus styles for accessibility */
        .sidebar-link:focus,
        button:focus,
        a:focus {
            outline: 2px solid #3b82f6;
            outline-offset: 2px;
        }

        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>

    {% block extra_css %}{% endblock %}
</head>

<body class="bg-gray-100">
    <!-- Navigation -->
    <nav class="bg-white shadow-sm border-b border-gray-200 fixed top-0 left-0 right-0 z-30">
    <div class="mx-auto px-3 sm:px-4 lg:px-8">
        <div class="flex justify-between items-center h-16">
            <div class="flex items-center min-w-0 flex-1">
                <!-- Desktop Sidebar Toggle -->
                <button
                    id="sidebar-toggle"
                    class="hidden md:block mr-3 p-2 rounded-lg text-gray-500 hover:text-gray-700 hover:bg-gray-100 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500"
                    aria-label="Toggle sidebar">
                    <i class="fas fa-bars text-lg" aria-hidden="true"></i>
                </button>
                
                <!-- Mobile Menu Toggle -->
                <button
                    id="mobile-menu-toggle"
                    class="md:hidden mr-2 p-2 rounded-lg text-gray-500 hover:text-gray-700 hover:bg-gray-100 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500"
                    aria-label="Open mobile menu">
                    <i class="fas fa-bars text-lg" aria-hidden="true"></i>
                </button>

                <!-- Logo -->
                <a href="{% url 'repavi_admin:dashboard' %}" class="flex items-center space-x-2 hover:opacity-80 transition-opacity min-w-0">
                    <img src="{% static 'images/repavi_lodge_dark_1.png' %}" alt="RepAvi" class="h-6 sm:h-8 w-6 sm:w-8 object-contain flex-shrink-0" />
                    <!-- Full text on desktop, short on mobile -->
                    <span class="hidden sm:block text-xl font-bold text-blue-600">RepAvi Admin</span>
                    <span class="sm:hidden text-lg font-bold text-blue-600">RepAvi</span>
                </a>
            </div>

            <!-- Desktop User Menu -->
            <div class="hidden md:flex items-center space-x-4">
                <div class="flex items-center space-x-2">
                    <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                        <i class="fas fa-user text-blue-600 text-sm" aria-hidden="true"></i>
                    </div>
                    <span class="text-gray-700 font-medium truncate max-w-32">{{ user.first_name|default:user.username }}</span>
                </div>
                <div class="border-l border-gray-300 pl-4">
                    <a href="{% url 'home:index' %}"
                        class="text-gray-500 hover:text-gray-700 text-sm transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 rounded px-2 py-1">
                        <i class="fas fa-external-link-alt mr-1" aria-hidden="true"></i>Voir le site
                    </a>
                </div>
                <div class="border-l border-gray-300 pl-4">
                    <a href="{% url 'users:logout' %}"
                        class="text-red-500 hover:text-red-700 text-sm transition-colors focus:outline-none focus:ring-2 focus:ring-red-500 rounded px-2 py-1">
                        <i class="fas fa-sign-out-alt mr-1" aria-hidden="true"></i>Déconnexion
                    </a>
                </div>
            </div>

            <!-- Mobile User Menu -->
            <div class="md:hidden relative">
                <button
                    id="mobile-user-menu-toggle"
                    class="flex items-center space-x-2 p-2 rounded-lg text-gray-700 hover:text-gray-900 hover:bg-gray-100 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500"
                    aria-label="User menu"
                    aria-expanded="false"
                    aria-haspopup="true">
                    <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                        <i class="fas fa-user text-blue-600 text-sm" aria-hidden="true"></i>
                    </div>
                    <i class="fas fa-chevron-down text-xs transition-transform duration-200" id="mobile-user-menu-icon" aria-hidden="true"></i>
                </button>

                <!-- Mobile Dropdown Menu -->
                <div
                    id="mobile-user-menu"
                    class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 opacity-0 invisible transition-all duration-200 z-50"
                    role="menu"
                    aria-labelledby="mobile-user-menu-toggle">
                    <div class="py-2">
                        <div class="px-4 py-2 border-b border-gray-100">
                            <p class="text-sm font-medium text-gray-900 truncate">{{ user.first_name|default:user.username }}</p>
                            <p class="text-xs text-gray-500 truncate">{{ user.email }}</p>
                        </div>
                        <a href="{% url 'home:index' %}"
                            class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 focus:outline-none focus:bg-gray-50 transition-colors"
                            role="menuitem">
                            <i class="fas fa-external-link-alt mr-2 w-4" aria-hidden="true"></i>Voir le site
                        </a>
                        <a href="{% url 'users:profile' %}"
                            class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 focus:outline-none focus:bg-gray-50 transition-colors"
                            role="menuitem">
                            <i class="fas fa-user mr-2 w-4" aria-hidden="true"></i>Mon profil
                        </a>
                        <div class="border-t border-gray-100 my-1"></div>
                        <a href="{% url 'users:logout' %}"
                            class="block px-4 py-2 text-sm text-red-600 hover:bg-red-50 focus:outline-none focus:bg-red-50 transition-colors"
                            role="menuitem">
                            <i class="fas fa-sign-out-alt mr-2 w-4" aria-hidden="true"></i>Déconnexion
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</nav>

    <!-- Mobile Overlay -->
    <div id="mobile-overlay" 
         class="fixed inset-0 bg-black bg-opacity-50 z-40 opacity-0 invisible transition-all duration-300 md:hidden"
         aria-hidden="true"></div>

    <!-- Sidebar -->
    <aside id="sidebar" 
           class="sidebar fixed top-16 left-0 w-72 h-screen bg-white shadow-sm border-r border-gray-200 z-20 overflow-y-auto md:translate-x-0"
           role="navigation" 
           aria-label="Main navigation">
        <nav class="mt-5 px-2 space-y-1">
            <!-- Dashboard Principal -->
            <a href="{% url 'repavi_admin:dashboard' %}"
                class="sidebar-link group relative flex items-center px-3 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-blue-50 hover:text-blue-600 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500">
                <i class="fas fa-chart-line w-5 text-center" aria-hidden="true"></i>
                <span class="sidebar-content ml-3">Dashboard Principal</span>
                <div class="tooltip sidebar-icon-only">Dashboard Principal</div>
            </a>

            <!-- SECTION MEUBLES -->
            <div class="pt-4">
                <p class="sidebar-content px-3 text-xs font-semibold text-green-600 uppercase tracking-wider">GESTION MEUBLES</p>

                <!-- Dashboard Meubles -->
                <a href="{% url 'meubles:dashboard' %}"
                    class="sidebar-link group relative flex items-center px-3 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-green-50 hover:text-green-600 transition-colors mt-2 focus:outline-none focus:ring-2 focus:ring-green-500">
                    <i class="fas fa-tachometer-alt w-5 text-center text-green-600" aria-hidden="true"></i>
                    <span class="sidebar-content ml-3">Dashboard Meubles</span>
                    <span class="sidebar-content ml-auto bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">
                        <i class="fas fa-star text-xs" aria-hidden="true"></i>
                    </span>
                    <div class="tooltip sidebar-icon-only">Dashboard Meubles</div>
                </a>

                <!-- Menu Meubles avec sous-menu -->
                <div class="relative">
                    <button onclick="toggleSubmenu('meubles-submenu')"
                        class="sidebar-link group relative flex items-center w-full px-3 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-green-50 hover:text-green-600 transition-colors focus:outline-none focus:ring-2 focus:ring-green-500"
                        aria-expanded="false"
                        aria-controls="meubles-submenu">
                        <i class="fas fa-couch w-5 text-center text-green-600" aria-hidden="true"></i>
                        <span class="sidebar-content ml-3">Meubles</span>
                        <i class="sidebar-content fas fa-chevron-down ml-auto transition-transform duration-200" id="meubles-submenu-icon" aria-hidden="true"></i>
                        <div class="tooltip sidebar-icon-only">Meubles</div>
                    </button>
                    
                    <div id="meubles-submenu" class="submenu bg-gray-50 rounded-lg mx-2 mt-1" role="menu">
                        <a href="{% url 'meubles:meubles_list' %}" 
                           class="flex items-center px-3 py-2 text-sm text-gray-600 hover:text-green-600 hover:bg-gray-100 rounded-lg pl-10 transition-colors focus:outline-none focus:ring-2 focus:ring-green-500"
                           role="menuitem">
                            <i class="fas fa-list w-4 mr-3" aria-hidden="true"></i>Liste des meubles
                        </a>
                        <a href="{% url 'meubles:meuble_create' %}" 
                           class="flex items-center px-3 py-2 text-sm text-gray-600 hover:text-green-600 hover:bg-gray-100 rounded-lg pl-10 transition-colors focus:outline-none focus:ring-2 focus:ring-green-500"
                           role="menuitem">
                            <i class="fas fa-plus w-4 mr-3" aria-hidden="true"></i>Nouveau meuble
                        </a>
                        <a href="{% url 'meubles:types_list' %}" 
                           class="flex items-center px-3 py-2 text-sm text-gray-600 hover:text-green-600 hover:bg-gray-100 rounded-lg pl-10 transition-colors focus:outline-none focus:ring-2 focus:ring-green-500"
                           role="menuitem">
                            <i class="fas fa-tags w-4 mr-3" aria-hidden="true"></i>Types de meubles
                        </a>
                        <a href="{% url 'meubles:meuble_import' %}" 
                           class="flex items-center px-3 py-2 text-sm text-gray-600 hover:text-green-600 hover:bg-gray-100 rounded-lg pl-10 transition-colors focus:outline-none focus:ring-2 focus:ring-green-500"
                           role="menuitem">
                            <i class="fas fa-upload w-4 mr-3" aria-hidden="true"></i>Import CSV
                        </a>
                    </div>
                </div>

                <!-- Menu Inventaires -->
                <div class="relative">
                    <button onclick="toggleSubmenu('inventaires-submenu')"
                        class="sidebar-link group relative flex items-center w-full px-3 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-green-50 hover:text-green-600 transition-colors focus:outline-none focus:ring-2 focus:ring-green-500"
                        aria-expanded="false"
                        aria-controls="inventaires-submenu">
                        <i class="fas fa-clipboard-list w-5 text-center text-green-600" aria-hidden="true"></i>
                        <span class="sidebar-content ml-3">Inventaires</span>
                        <i class="sidebar-content fas fa-chevron-down ml-auto transition-transform duration-200" id="inventaires-submenu-icon" aria-hidden="true"></i>
                        <div class="tooltip sidebar-icon-only">Inventaires</div>
                    </button>
                    
                    <div id="inventaires-submenu" class="submenu bg-gray-50 rounded-lg mx-2 mt-1" role="menu">
                        <a href="{% url 'meubles:inventaires_list' %}" 
                           class="flex items-center px-3 py-2 text-sm text-gray-600 hover:text-green-600 hover:bg-gray-100 rounded-lg pl-10 transition-colors focus:outline-none focus:ring-2 focus:ring-green-500"
                           role="menuitem">
                            <i class="fas fa-list w-4 mr-3" aria-hidden="true"></i>Tous les inventaires
                        </a>
                        <a href="{% url 'meubles:inventaire_create' %}" 
                           class="flex items-center px-3 py-2 text-sm text-gray-600 hover:text-green-600 hover:bg-gray-100 rounded-lg pl-10 transition-colors focus:outline-none focus:ring-2 focus:ring-green-500"
                           role="menuitem">
                            <i class="fas fa-plus w-4 mr-3" aria-hidden="true"></i>Nouvel inventaire
                        </a>
                    </div>
                </div>

                <!-- Menu Rapports -->
                <div class="relative">
                    <button onclick="toggleSubmenu('rapports-submenu')"
                        class="sidebar-link group relative flex items-center w-full px-3 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-green-50 hover:text-green-600 transition-colors focus:outline-none focus:ring-2 focus:ring-green-500"
                        aria-expanded="false"
                        aria-controls="rapports-submenu">
                        <i class="fas fa-chart-bar w-5 text-center text-green-600" aria-hidden="true"></i>
                        <span class="sidebar-content ml-3">Rapports</span>
                        <i class="sidebar-content fas fa-chevron-down ml-auto transition-transform duration-200" id="rapports-submenu-icon" aria-hidden="true"></i>
                        <div class="tooltip sidebar-icon-only">Rapports</div>
                    </button>
                    
                    <div id="rapports-submenu" class="submenu bg-gray-50 rounded-lg mx-2 mt-1" role="menu">
                        <a href="{% url 'meubles:generer_rapport' %}" 
                           class="flex items-center px-3 py-2 text-sm text-gray-600 hover:text-green-600 hover:bg-gray-100 rounded-lg pl-10 transition-colors focus:outline-none focus:ring-2 focus:ring-green-500"
                           role="menuitem">
                            <i class="fas fa-file-alt w-4 mr-3" aria-hidden="true"></i>Nouveau rapport
                        </a>
                        <a href="{% url 'meubles:generer_rapport' %}?type_rapport=defectueux" 
                           class="flex items-center px-3 py-2 text-sm text-gray-600 hover:text-green-600 hover:bg-gray-100 rounded-lg pl-10 transition-colors focus:outline-none focus:ring-2 focus:ring-green-500"
                           role="menuitem">
                            <i class="fas fa-exclamation-triangle w-4 mr-3 text-red-500" aria-hidden="true"></i>Meubles défectueux
                        </a>
                        <a href="{% url 'meubles:generer_rapport' %}?type_rapport=verification" 
                           class="flex items-center px-3 py-2 text-sm text-gray-600 hover:text-green-600 hover:bg-gray-100 rounded-lg pl-10 transition-colors focus:outline-none focus:ring-2 focus:ring-green-500"
                           role="menuitem">
                            <i class="fas fa-clock w-4 mr-3 text-orange-500" aria-hidden="true"></i>À vérifier
                        </a>
                        <a href="{% url 'meubles:generer_rapport' %}?type_rapport=valeur" 
                           class="flex items-center px-3 py-2 text-sm text-gray-600 hover:text-green-600 hover:bg-gray-100 rounded-lg pl-10 transition-colors focus:outline-none focus:ring-2 focus:ring-green-500"
                           role="menuitem">
                            <i class="fas fa-dollar-sign w-4 mr-3 text-green-500" aria-hidden="true"></i>Évaluation financière
                        </a>
                    </div>
                </div>
            </div>

            <!-- Section Propriétés -->
            <div class="pt-4">
                <p class="sidebar-content px-3 text-xs font-semibold text-gray-400 uppercase tracking-wider">Propriétés</p>

                <a href="{% url 'repavi_admin:maisons_list' %}"
                    class="sidebar-link group relative flex items-center px-3 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-blue-50 hover:text-blue-600 transition-colors mt-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <i class="fas fa-home w-5 text-center" aria-hidden="true"></i>
                    <span class="sidebar-content ml-3">Maisons</span>
                    <div class="tooltip sidebar-icon-only">Maisons</div>
                </a>

                <a href="{% url 'repavi_admin:villes_list' %}"
                    class="sidebar-link group relative flex items-center px-3 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-blue-50 hover:text-blue-600 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <i class="fas fa-map-marker-alt w-5 text-center" aria-hidden="true"></i>
                    <span class="sidebar-content ml-3">Villes</span>
                    <div class="tooltip sidebar-icon-only">Villes</div>
                </a>

                <a href="{% url 'repavi_admin:categories_list' %}"
                    class="sidebar-link group relative flex items-center px-3 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-blue-50 hover:text-blue-600 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <i class="fas fa-tags w-5 text-center" aria-hidden="true"></i>
                    <span class="sidebar-content ml-3">Catégories</span>
                    <div class="tooltip sidebar-icon-only">Catégories</div>
                </a>

                <a href="{% url 'repavi_admin:photos_list' %}"
                    class="sidebar-link group relative flex items-center px-3 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-blue-50 hover:text-blue-600 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <i class="fas fa-camera w-5 text-center" aria-hidden="true"></i>
                    <span class="sidebar-content ml-3">Photos</span>
                    <div class="tooltip sidebar-icon-only">Photos</div>
                </a>
            </div>

            <!-- Section Réservations -->
            <div class="pt-4">
                <p class="sidebar-content px-3 text-xs font-semibold text-gray-400 uppercase tracking-wider">Réservations</p>

                <a href="{% url 'reservations:dashboard_alt' %}"
                    class="sidebar-link group relative flex items-center px-3 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-blue-50 hover:text-blue-600 transition-colors mt-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <i class="fas fa-calendar-check w-5 text-center" aria-hidden="true"></i>
                    <span class="sidebar-content ml-3">Dashboard</span>
                    <span class="sidebar-content ml-auto bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full">
                        <i class="fas fa-bolt text-xs" aria-hidden="true"></i>
                    </span>
                    <div class="tooltip sidebar-icon-only">Dashboard Réservations</div>
                </a>

                <a href="{% url 'reservations:dashboard' %}"
                    class="sidebar-link group relative flex items-center px-3 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-blue-50 hover:text-blue-600 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <i class="fas fa-calendar-check w-5 text-center" aria-hidden="true"></i>
                    <span class="sidebar-content ml-3">Gérer réservations</span>
                    <div class="tooltip sidebar-icon-only">Gérer réservations</div>
                </a>

                <a href="{% url 'reservations:mes_reservations' %}"
                    class="sidebar-link group relative flex items-center px-3 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-blue-50 hover:text-blue-600 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <i class="fas fa-list w-5 text-center" aria-hidden="true"></i>
                    <span class="sidebar-content ml-3">Toutes les réservations</span>
                    <div class="tooltip sidebar-icon-only">Toutes les réservations</div>
                </a>
            </div>

            <!-- Section Administration -->
            {% if user.is_superuser or user.role == 'SUPER_ADMIN' %}
            <div class="border-t border-gray-200 pt-4 mt-4">
                <p class="sidebar-content px-3 text-xs font-semibold text-gray-400 uppercase tracking-wider">Administration</p>

                <a href="{% url 'repavi_admin:admin_users_list' %}"
                    class="sidebar-link group relative flex items-center px-3 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-purple-50 hover:text-purple-600 transition-colors mt-2 focus:outline-none focus:ring-2 focus:ring-purple-500">
                    <i class="fas fa-users w-5 text-center" aria-hidden="true"></i>
                    <span class="sidebar-content ml-3">Utilisateurs</span>
                    <div class="tooltip sidebar-icon-only">Utilisateurs</div>
                </a>
            </div>
            {% endif %}

            <!-- Section Actions Rapides -->
            <div class="pt-4 border-t border-gray-200 mt-4">
                <p class="sidebar-content px-3 text-xs font-semibold text-indigo-600 uppercase tracking-wider">Actions Rapides</p>

                <a href="{% url 'meubles:meuble_create' %}"
                    class="sidebar-link group relative flex items-center px-3 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-indigo-50 hover:text-indigo-600 transition-colors mt-2 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    <i class="fas fa-plus w-5 text-center text-indigo-600" aria-hidden="true"></i>
                    <span class="sidebar-content ml-3">+ Nouveau Meuble</span>
                    <div class="tooltip sidebar-icon-only">Nouveau Meuble</div>
                </a>

                <a href="{% url 'meubles:inventaire_create' %}"
                    class="sidebar-link group relative flex items-center px-3 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-indigo-50 hover:text-indigo-600 transition-colors focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    <i class="fas fa-clipboard-check w-5 text-center text-indigo-600" aria-hidden="true"></i>
                    <span class="sidebar-content ml-3">+ Inventaire</span>
                    <div class="tooltip sidebar-icon-only">Nouvel Inventaire</div>
                </a>

                <a href="{% url 'meubles:types_list' %}"
                    class="sidebar-link group relative flex items-center px-3 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-indigo-50 hover:text-indigo-600 transition-colors focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    <i class="fas fa-tag w-5 text-center text-indigo-600" aria-hidden="true"></i>
                    <span class="sidebar-content ml-3">+ Type Meuble</span>
                    <div class="tooltip sidebar-icon-only">Nouveau Type</div>
                </a>

                <a href="{% url 'meubles:meuble_import' %}"
                    class="sidebar-link group relative flex items-center px-3 py-2 text-sm font-medium rounded-lg text-gray-600 hover:bg-indigo-50 hover:text-indigo-600 transition-colors focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    <i class="fas fa-file-upload w-5 text-center text-indigo-600" aria-hidden="true"></i>
                    <span class="sidebar-content ml-3">Import CSV</span>
                    <div class="tooltip sidebar-icon-only">Import CSV</div>
                </a>
            </div>
        </nav>
    </aside>

    <!-- Main Content -->
    <main id="main-content" class="ml-72 mt-16 min-h-screen bg-gray-50 transition-all duration-300">
        <!-- Page Header -->
        <header class="bg-white shadow-sm border-b border-gray-200 px-4 py-4">
            <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
                <div>
                    <h1 class="text-2xl font-bold text-gray-900">
                        {% block page_title %}RepAvi Admin{% endblock %}
                    </h1>
                    {% block breadcrumb %}{% endblock %}
                </div>
                <div class="flex items-center space-x-3">
                    {% block header_actions %}
                    <a href="{% url 'meubles:dashboard' %}"
                        class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors">
                        <i class="fas fa-couch mr-2" aria-hidden="true"></i>
                        Meubles
                    </a>
                    {% endblock %}
                </div>
            </div>
        </header>

        <!-- Messages -->
        {% if messages %}
        <div class="px-4 py-4">
            {% for message in messages %}
            <div class="alert flex items-center p-4 mb-3 border rounded-lg fade-in transition-all duration-300
                    {% if message.tags == 'success' %}bg-green-50 border-green-200 text-green-800
                    {% elif message.tags == 'error' %}bg-red-50 border-red-200 text-red-800
                    {% elif message.tags == 'warning' %}bg-yellow-50 border-yellow-200 text-yellow-800
                    {% else %}bg-blue-50 border-blue-200 text-blue-800{% endif %}"
                 role="alert" aria-live="polite">
                <i class="fas fa-{% if message.tags == 'success' %}check-circle{% elif message.tags == 'error' %}exclamation-circle{% elif message.tags == 'warning' %}exclamation-triangle{% else %}info-circle{% endif %} mr-3 flex-shrink-0" aria-hidden="true"></i>
                <span class="flex-1">{{ message }}</span>
                <button onclick="this.parentElement.remove()" 
                        class="ml-auto text-gray-400 hover:text-gray-600 p-1 rounded focus:outline-none focus:ring-2 focus:ring-gray-500"
                        aria-label="Close alert">
                    <i class="fas fa-times" aria-hidden="true"></i>
                </button>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Page Content -->
        <div class="px-4 py-4">
            {% block content %}
            <!-- Default Dashboard Content -->
            <div class="space-y-6">
                <!-- Statistics Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <!-- Meubles Widget -->
                    <div class="bg-gradient-to-r from-green-500 to-green-600 rounded-xl p-6 text-white hover:shadow-lg transition-all duration-300 hover:-translate-y-1">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <i class="fas fa-couch text-3xl opacity-80" aria-hidden="true"></i>
                            </div>
                            <div class="ml-4">
                                <div class="text-2xl font-bold">{{ total_meubles|default:0 }}</div>
                                <div class="text-sm opacity-90">Meubles Total</div>
                                <a href="{% url 'meubles:dashboard' %}"
                                    class="text-xs underline opacity-75 hover:opacity-100 transition-opacity">
                                    Voir détails →
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Maisons Widget -->
                    <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl p-6 text-white hover:shadow-lg transition-all duration-300 hover:-translate-y-1">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <i class="fas fa-home text-3xl opacity-80" aria-hidden="true"></i>
                            </div>
                            <div class="ml-4">
                                <div class="text-2xl font-bold">{{ total_maisons|default:0 }}</div>
                                <div class="text-sm opacity-90">Maisons</div>
                                <a href="{% url 'repavi_admin:maisons_list' %}"
                                    class="text-xs underline opacity-75 hover:opacity-100 transition-opacity">
                                    Gérer →
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Réservations Widget -->
                    <div class="bg-gradient-to-r from-orange-500 to-orange-600 rounded-xl p-6 text-white hover:shadow-lg transition-all duration-300 hover:-translate-y-1">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <i class="fas fa-calendar-check text-3xl opacity-80" aria-hidden="true"></i>
                            </div>
                            <div class="ml-4">
                                <div class="text-2xl font-bold">{{ total_reservations|default:0 }}</div>
                                <div class="text-sm opacity-90">Réservations</div>
                                <a href="{% url 'reservations:mes_reservations' %}"
                                    class="text-xs underline opacity-75 hover:opacity-100 transition-opacity">
                                    Voir toutes →
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Villes Widget -->
                    <div class="bg-gradient-to-r from-purple-500 to-purple-600 rounded-xl p-6 text-white hover:shadow-lg transition-all duration-300 hover:-translate-y-1">
                        <div class="flex items-center">
                            <div class="flex-shrink-0">
                                <i class="fas fa-map-marker-alt text-3xl opacity-80" aria-hidden="true"></i>
                            </div>
                            <div class="ml-4">
                                <div class="text-2xl font-bold">{{ total_villes|default:0 }}</div>
                                <div class="text-sm opacity-90">Villes</div>
                                <a href="{% url 'repavi_admin:villes_list' %}"
                                    class="text-xs underline opacity-75 hover:opacity-100 transition-opacity">
                                    Gérer →
                                </a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions Section -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">
                        <i class="fas fa-couch text-green-600 mr-2" aria-hidden="true"></i>
                        Gestion des Meubles - Actions Rapides
                    </h3>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <a href="{% url 'meubles:dashboard' %}"
                            class="flex items-center p-4 bg-green-50 rounded-lg hover:bg-green-100 transition-colors group focus:outline-none focus:ring-2 focus:ring-green-500">
                            <div class="flex-shrink-0">
                                <i class="fas fa-tachometer-alt text-green-600 text-xl" aria-hidden="true"></i>
                            </div>
                            <div class="ml-4">
                                <div class="text-sm font-medium text-gray-900 group-hover:text-green-700">
                                    Dashboard Meubles
                                </div>
                                <div class="text-xs text-gray-500">
                                    Statistiques détaillées
                                </div>
                            </div>
                        </a>

                        <a href="{% url 'meubles:meuble_create' %}"
                            class="flex items-center p-4 bg-blue-50 rounded-lg hover:bg-blue-100 transition-colors group focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <div class="flex-shrink-0">
                                <i class="fas fa-plus text-blue-600 text-xl" aria-hidden="true"></i>
                            </div>
                            <div class="ml-4">
                                <div class="text-sm font-medium text-gray-900 group-hover:text-blue-700">
                                    Nouveau Meuble
                                </div>
                                <div class="text-xs text-gray-500">
                                    Ajouter à l'inventaire
                                </div>
                            </div>
                        </a>

                        <a href="{% url 'meubles:inventaire_create' %}"
                            class="flex items-center p-4 bg-purple-50 rounded-lg hover:bg-purple-100 transition-colors group focus:outline-none focus:ring-2 focus:ring-purple-500">
                            <div class="flex-shrink-0">
                                <i class="fas fa-clipboard-list text-purple-600 text-xl" aria-hidden="true"></i>
                            </div>
                            <div class="ml-4">
                                <div class="text-sm font-medium text-gray-900 group-hover:text-purple-700">
                                    Nouvel Inventaire
                                </div>
                                <div class="text-xs text-gray-500">
                                    État des lieux
                                </div>
                            </div>
                        </a>

                        <a href="{% url 'meubles:generer_rapport' %}"
                            class="flex items-center p-4 bg-orange-50 rounded-lg hover:bg-orange-100 transition-colors group focus:outline-none focus:ring-2 focus:ring-orange-500">
                            <div class="flex-shrink-0">
                                <i class="fas fa-chart-bar text-orange-600 text-xl" aria-hidden="true"></i>
                            </div>
                            <div class="ml-4">
                                <div class="text-sm font-medium text-gray-900 group-hover:text-orange-700">
                                    Rapports
                                </div>
                                <div class="text-xs text-gray-500">
                                    Analyses et exports
                                </div>
                            </div>
                        </a>
                    </div>
                </div>

                <!-- Alert for Defective Furniture -->
                {% if meubles_defectueux %}
                <div class="bg-red-50 border border-red-200 rounded-xl p-6">
                    <div class="flex items-start">
                        <div class="flex-shrink-0">
                            <i class="fas fa-exclamation-triangle text-red-600 text-xl" aria-hidden="true"></i>
                        </div>
                        <div class="ml-3">
                            <h3 class="text-sm font-medium text-red-800">Attention Requise</h3>
                            <div class="mt-2 text-sm text-red-700">
                                <p>{{ meubles_defectueux|length }} meuble{{ meubles_defectueux|length|pluralize }}
                                    défectueux détecté{{ meubles_defectueux|length|pluralize }}.</p>
                                <a href="{% url 'meubles:meubles_list' %}?etat=defectueux"
                                    class="underline font-medium hover:text-red-800 focus:outline-none focus:ring-2 focus:ring-red-500 rounded">
                                    Voir la liste complète →
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
            {% endblock %}
        </div>
    </main>

    <!-- Scripts -->
    <script>
        // Sidebar and mobile user menu functionality
        (function() {
            'use strict';

            // Sidebar elements
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('main-content');
            const sidebarToggle = document.getElementById('sidebar-toggle');
            const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
            const mobileOverlay = document.getElementById('mobile-overlay');

            // Mobile user menu elements
            const mobileUserMenuToggle = document.getElementById('mobile-user-menu-toggle');
            const mobileUserMenu = document.getElementById('mobile-user-menu');
            const mobileUserMenuIcon = document.getElementById('mobile-user-menu-icon');

            // State management
            let sidebarCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
            let isMobileUserMenuOpen = false;

            // Initialize sidebar state
            function initializeSidebar() {
                if (sidebarCollapsed && window.innerWidth >= 768) {
                    sidebar.classList.add('collapsed');
                    if (mainContent) {
                        mainContent.classList.replace('ml-72', 'ml-16');
                    }
                }
            }

            // Toggle desktop sidebar
            function toggleDesktopSidebar() {
                if (!sidebar || !mainContent) return;
                
                sidebar.classList.toggle('collapsed');
                if (sidebar.classList.contains('collapsed')) {
                    mainContent.classList.replace('ml-72', 'ml-16');
                } else {
                    mainContent.classList.replace('ml-16', 'ml-72');
                }
                sidebarCollapsed = !sidebarCollapsed;
                localStorage.setItem('sidebarCollapsed', sidebarCollapsed);
                
                // Close all submenus when collapsed
                if (sidebarCollapsed) {
                    closeAllSubmenus();
                }
            }

            // Toggle mobile sidebar
            function toggleMobileSidebar() {
                if (!sidebar || !mobileOverlay) return;
                
                sidebar.classList.toggle('mobile-open');
                mobileOverlay.classList.toggle('opacity-0', !sidebar.classList.contains('mobile-open'));
                mobileOverlay.classList.toggle('invisible', !sidebar.classList.contains('mobile-open'));
                
                // Close mobile user menu when opening sidebar
                if (sidebar.classList.contains('mobile-open')) {
                    closeMobileUserMenu();
                }
            }

            // Close mobile sidebar
            function closeMobileSidebar() {
                if (!sidebar || !mobileOverlay) return;
                
                sidebar.classList.remove('mobile-open');
                mobileOverlay.classList.add('opacity-0', 'invisible');
            }

            // Toggle mobile user menu
            function toggleMobileUserMenu() {
                if (!mobileUserMenuToggle || !mobileUserMenu || !mobileUserMenuIcon) return;
                
                isMobileUserMenuOpen = !isMobileUserMenuOpen;
                
                if (isMobileUserMenuOpen) {
                    mobileUserMenu.classList.remove('opacity-0', 'invisible');
                    mobileUserMenu.classList.add('opacity-100', 'visible');
                    mobileUserMenuIcon.style.transform = 'rotate(180deg)';
                    mobileUserMenuToggle.setAttribute('aria-expanded', 'true');
                    
                    // Close mobile sidebar if open
                    closeMobileSidebar();
                } else {
                    mobileUserMenu.classList.add('opacity-0', 'invisible');
                    mobileUserMenu.classList.remove('opacity-100', 'visible');
                    mobileUserMenuIcon.style.transform = 'rotate(0deg)';
                    mobileUserMenuToggle.setAttribute('aria-expanded', 'false');
                }
            }

            // Close mobile user menu
            function closeMobileUserMenu() {
                if (isMobileUserMenuOpen) {
                    toggleMobileUserMenu();
                }
            }

            // Handle window resize
            function handleResize() {
                if (!mainContent) return;
                
                if (window.innerWidth >= 768) {
                    closeMobileSidebar();
                    closeMobileUserMenu();
                    mainContent.classList.remove('ml-0');
                    if (sidebarCollapsed) {
                        mainContent.classList.replace('ml-72', 'ml-16');
                    } else {
                        mainContent.classList.replace('ml-16', 'ml-72');
                    }
                } else {
                    mainContent.classList.remove('ml-72', 'ml-16');
                    mainContent.classList.add('ml-0');
                }
            }

            // Submenu functionality
            window.toggleSubmenu = function(submenuId) {
                const submenu = document.getElementById(submenuId);
                const icon = document.getElementById(submenuId + '-icon');
                const button = document.querySelector(`[aria-controls="${submenuId}"]`);
                
                if (!submenu || !icon || !button) return;
                
                const isActive = submenu.classList.contains('active');
                
                // Close all other submenus
                closeAllSubmenus();
                
                // Toggle current submenu
                if (!isActive) {
                    submenu.classList.add('active');
                    icon.style.transform = 'rotate(180deg)';
                    button.setAttribute('aria-expanded', 'true');
                }
            };

            function closeAllSubmenus() {
                document.querySelectorAll('.submenu').forEach(submenu => {
                    submenu.classList.remove('active');
                });
                document.querySelectorAll('[id$="-submenu-icon"]').forEach(icon => {
                    icon.style.transform = 'rotate(0deg)';
                });
                document.querySelectorAll('[aria-controls*="submenu"]').forEach(button => {
                    button.setAttribute('aria-expanded', 'false');
                });
            }

            // Set active menu item
            function setActiveMenuItem() {
                const currentPath = window.location.pathname;
                const menuLinks = document.querySelectorAll('.sidebar-link[href]');

                menuLinks.forEach(link => {
                    const href = link.getAttribute('href');
                    if (currentPath.startsWith(href) && href !== '/repavi-admin/') {
                        link.classList.add('bg-blue-50', 'text-blue-600');
                        link.classList.remove('text-gray-600');
                        
                        // Open parent submenu if necessary
                        const parentSubmenu = link.closest('.submenu');
                        if (parentSubmenu) {
                            parentSubmenu.classList.add('active');
                            const icon = document.querySelector('#' + parentSubmenu.id + '-icon');
                            const button = document.querySelector(`[aria-controls="${parentSubmenu.id}"]`);
                            if (icon) icon.style.transform = 'rotate(180deg)';
                            if (button) button.setAttribute('aria-expanded', 'true');
                        }
                    } else if (currentPath === '/repavi-admin/' && href.includes('dashboard')) {
                        link.classList.add('bg-blue-50', 'text-blue-600');
                        link.classList.remove('text-gray-600');
                    }

                    // Special highlighting for furniture section
                    if (href.includes('meubles') && currentPath.includes('meubles')) {
                        link.classList.add('bg-green-50', 'text-green-600');
                        link.classList.remove('text-gray-600', 'bg-blue-50', 'text-blue-600');
                    }
                });
            }

            // Auto-hide alerts
            function setupAlertAutoHide() {
                setTimeout(() => {
                    const alerts = document.querySelectorAll('.alert');
                    alerts.forEach(alert => {
                        alert.style.opacity = '0';
                        alert.style.transform = 'translateY(-10px)';
                        setTimeout(() => {
                            if (alert.parentNode) {
                                alert.remove();
                            }
                        }, 300);
                    });
                }, 5000);
            }

            // Setup mobile user menu keyboard navigation
            function setupMobileUserMenuKeyboard() {
                if (!mobileUserMenu) return;
                
                const menuItems = mobileUserMenu.querySelectorAll('[role="menuitem"]');
                
                menuItems.forEach((item, index) => {
                    item.addEventListener('keydown', function(e) {
                        if (e.key === 'ArrowDown') {
                            e.preventDefault();
                            const nextIndex = (index + 1) % menuItems.length;
                            menuItems[nextIndex].focus();
                        } else if (e.key === 'ArrowUp') {
                            e.preventDefault();
                            const prevIndex = (index - 1 + menuItems.length) % menuItems.length;
                            menuItems[prevIndex].focus();
                        } else if (e.key === 'Enter' || e.key === ' ') {
                            e.preventDefault();
                            item.click();
                        }
                    });
                });
                
                // Focus first menu item when menu opens with keyboard
                if (mobileUserMenuToggle) {
                    mobileUserMenuToggle.addEventListener('keydown', function(e) {
                        if ((e.key === 'Enter' || e.key === ' ') && isMobileUserMenuOpen && menuItems.length > 0) {
                            e.preventDefault();
                            menuItems[0].focus();
                        }
                    });
                }
            }

            // Setup click outside handlers
            function setupClickOutsideHandlers() {
                document.addEventListener('click', function(e) {
                    // Close mobile user menu when clicking outside
                    if (mobileUserMenuToggle && mobileUserMenu && 
                        !mobileUserMenuToggle.contains(e.target) && 
                        !mobileUserMenu.contains(e.target)) {
                        closeMobileUserMenu();
                    }
                });
            }

            // Event listeners
            if (sidebarToggle) {
                sidebarToggle.addEventListener('click', toggleDesktopSidebar);
            }

            if (mobileMenuToggle) {
                mobileMenuToggle.addEventListener('click', toggleMobileSidebar);
            }

            if (mobileOverlay) {
                mobileOverlay.addEventListener('click', function() {
                    closeMobileSidebar();
                    closeMobileUserMenu();
                });
            }

            // Mobile user menu event listeners
            if (mobileUserMenuToggle) {
                mobileUserMenuToggle.addEventListener('click', function(e) {
                    e.stopPropagation();
                    toggleMobileUserMenu();
                });
            }

            window.addEventListener('resize', handleResize);

            // Initialize on DOM ready
            document.addEventListener('DOMContentLoaded', () => {
                initializeSidebar();
                setActiveMenuItem();
                setupAlertAutoHide();
                setupMobileUserMenuKeyboard();
                setupClickOutsideHandlers();
                handleResize();
                
                // Add fade-in animation to cards
                const cards = document.querySelectorAll('[class*="hover:shadow-lg"]');
                cards.forEach((card, index) => {
                    setTimeout(() => {
                        card.classList.add('fade-in');
                    }, index * 100);
                });
            });

            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                // Sidebar toggle shortcut
                if (e.ctrlKey && e.key === 'b') {
                    e.preventDefault();
                    if (window.innerWidth >= 768) {
                        toggleDesktopSidebar();
                    } else {
                        toggleMobileSidebar();
                    }
                }
                
                // Escape key handling
                if (e.key === 'Escape') {
                    if (sidebar && sidebar.classList.contains('mobile-open')) {
                        closeMobileSidebar();
                    }
                    if (isMobileUserMenuOpen) {
                        closeMobileUserMenu();
                        if (mobileUserMenuToggle) {
                            mobileUserMenuToggle.focus();
                        }
                    }
                }
            });

            // Expose functions globally if needed
            window.toggleSubmenu = window.toggleSubmenu;
            window.closeMobileSidebar = closeMobileSidebar;
            window.closeMobileUserMenu = closeMobileUserMenu;

        })();
    </script>
    <style>
/* Ensure proper spacing and prevent overflow */
.max-w-32 {
    max-width: 8rem;
}

/* Better focus styles for mobile */
@media (max-width: 768px) {
    .focus\:ring-2:focus {
        outline: 2px solid #3b82f6;
        outline-offset: 2px;
    }
}

/* Prevent horizontal scroll on very small screens */
@media (max-width: 320px) {
    .h-16 {
        height: 3.5rem;
    }
    
    .text-lg {
        font-size: 1rem;
        line-height: 1.5rem;
    }
}
</style>

    {% block extra_js %}{% endblock %}
</body>

</html>